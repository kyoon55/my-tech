<!DOCTYPE html><html lang="en-US"><body> <script> var elements = document.querySelectorAll('p'); Array.prototype.forEach.call(elements, function(el, i){ if(el.innerHTML=='[expand]') { var parentcontent = el.parentNode.innerHTML.replace('<p>[expand]</p>','<div class="expand" style="display: none; height: 0; overflow: hidden;">').replace('<p>[/expand]</p>','</div>'); el.parentNode.innerHTML = parentcontent; } }); var elements = document.querySelectorAll('div.expand'); Array.prototype.forEach.call(elements, function(el, i){ el.previousElementSibling.innerHTML = el.previousElementSibling.innerHTML + '<span>..&nbsp; <a href="#" style="cursor: pointer;" onclick="this.parentNode.parentNode.nextElementSibling.style.display = \'block\'; this.parentNode.parentNode.nextElementSibling.style.height = \'auto\'; this.parentNode.style.display = \'none\';">read&nbsp;more&nbsp;&rarr;</a></span>'; }); </script> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/my-tech/" class="site-title lh-tight"> My SRE Stuff </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/my-tech/" class="nav-list-link">My Page</a><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in AWS category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/AWS" class="nav-list-link">AWS</a><ul class="nav-list"><li class="nav-list-item active"><a href="/my-tech/doc/AWS/creation-of-basic-infra/" class="nav-list-link active">CloudFormation Stack Deployment Examples Part 1</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Ansible category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Ansible" class="nav-list-link">Ansible</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Ansible/ansible-1/" class="nav-list-link">Create a host, ssh into the public EC2 instnace</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in CICD category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/CICD" class="nav-list-link">CICD</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Docker category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Docker" class="nav-list-link">Docker</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Docker/docker-1/" class="nav-list-link">Docker First Setup From A Cloud Guru Part 1</a><li class="nav-list-item "><a href="/my-tech/doc/Docker/docker-2/" class="nav-list-link">Docker First Setup From A Cloud Guru Part 2</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Kubernetes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Kubernetes" class="nav-list-link">Kubernetes</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Kubernetes/doc-1/" class="nav-list-link">Kubernetes 1.24 Installation</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Misc category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Misc" class="nav-list-link">Misc</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Misc/template/" class="nav-list-link">tutorial about the running a sample docker image in numbered steps</a><li class="nav-list-item "><a href="/my-tech/template/" class="nav-list-link">Title</a><li class="nav-list-item "><a href="/my-tech/doc/Misc/tutorial-about-the-running-a-sample-docker-image-in-numbered-steps%20copy/" class="nav-list-link">tutorial about the running a sample docker image in numbered steps</a><li class="nav-list-item "><a href="/my-tech/doc/Misc/a-tutorial-about-creating-an-AWS-basic-infrastructure,-with-VPC,-publicc,-and-private-subnets,-IGW,-NAT,-security-groups,-EC2-and-RDS-that-runs-postgresql/" class="nav-list-link">a tutorial about creating an AWS basic infrastructure, with VPC, public, and private subnets, IGW, NAT, security groups, EC2 and RDS that runs postgresql</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Terraform category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Terraform" class="nav-list-link">Terraform</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/docs/Terraform/doc-1/" class="nav-list-link">Terraform Deployment of basic infrastructure on AWS</a></ul></ul></nav></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search My SRE Stuff" aria-label="Search My SRE Stuff" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/my-tech/docs/AWS">AWS</a><li class="breadcrumb-nav-list-item"><span>CloudFormation Stack Deployment Examples Part 1</span></ol></nav><div id="main-content" class="main-content"><main><h1> CloudFormation Stack Deployment Examples Part 1</h1><h2> List of CloudFormation Stack Deployments for AWS resources</h2><h3> Date Posted: 2023 05 03</h3><h2 id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents</h2><ul><li><a href="#basic-infrastructure-cloudformation-template-with-ec2-instance">Basic Infrastructure CloudFormation Template with EC2 Instance</a></ul><h1 id="basic-infrastructure-cloudformation-template-with-ec2-instance"> <a href="#basic-infrastructure-cloudformation-template-with-ec2-instance" class="anchor-heading" aria-labelledby="basic-infrastructure-cloudformation-template-with-ec2-instance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Infrastructure CloudFormation Template with EC2 Instance</h1><details> <summary>Provisioing the Basic Infrastructure by Creating a CloudFormation Stack</summary><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">AWSTemplateFormatVersion</span><span class="pi">:</span> <span class="s">2010-09-09</span>
<span class="na">Description</span><span class="pi">:</span> <span class="s">Basic Infrastructure CloudFormation Template with EC2 Instance</span>

<span class="na">Parameters</span><span class="pi">:</span>
  <span class="na">KeyName</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Name of an existing EC2 KeyPair to enable SSH access to the instance</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::KeyPair::KeyName</span>
    <span class="na">Default</span><span class="pi">:</span> <span class="s">Dev</span>
    
<span class="na">Resources</span><span class="pi">:</span>
  <span class="na">MyVPC</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPC</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/16"</span>
      <span class="na">EnableDnsSupport</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">EnableDnsHostnames</span><span class="pi">:</span> <span class="kc">true</span>

  <span class="na">MySubnet</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1a"</span>

  <span class="na">MyInternetGateway</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::InternetGateway</span>

  <span class="na">MyVPCGatewayAttachment</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">InternetGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MyRouteTable</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyRoute</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">MyVPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyRouteTable</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">GatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MySubnetRouteTableAssociation</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MySubnet</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyRouteTable</span>

  <span class="na">MySecurityGroup</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SecurityGroup</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">GroupDescription</span><span class="pi">:</span> <span class="s2">"</span><span class="s">My</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Group"</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">SecurityGroupIngress</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">IpProtocol</span><span class="pi">:</span> <span class="s">tcp</span>
          <span class="na">FromPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">ToPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">CidrIp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>


  <span class="na">MyInstance</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Instance</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceType</span><span class="pi">:</span> <span class="s">t2.micro</span>
      <span class="na">NetworkInterfaces</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">GroupSet</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">MySecurityGroup</span>
          <span class="na">AssociatePublicIpAddress</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">DeviceIndex</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">DeleteOnTermination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MySubnet</span>
      <span class="na">KeyName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">KeyName</span>
      <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-97785bed"</span> 
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">instance-1"</span>
 
  <span class="na">MyEIP</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIP</span>

  <span class="na">MyInstanceEIPAssociation</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIPAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInstance</span>
      <span class="na">EIP</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyEIP</span>

<span class="na">Outputs</span><span class="pi">:</span>
  <span class="na">Instance1PublicIP</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Public IP Address of instance-1</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyInstance.PublicIp</span></code></pre></figure></details><h2 id="parameters"> <a href="#parameters" class="anchor-heading" aria-labelledby="parameters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Parameters</h2><ul><li><code class="language-plaintext highlighter-rouge">KeyName</code>: This parameter allows you to specify the name of an existing EC2 KeyPair to enable SSH access to the instance. The default value is set to <code class="language-plaintext highlighter-rouge">Dev</code>.</ul><h2 id="resources"> <a href="#resources" class="anchor-heading" aria-labelledby="resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Resources</h2><h3 id="vpc-myvpc"> <a href="#vpc-myvpc" class="anchor-heading" aria-labelledby="vpc-myvpc"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> VPC (<code class="language-plaintext highlighter-rouge">MyVPC</code>)</h3><ul><li>Creates a Virtual Private Cloud (VPC) with the CIDR block <code class="language-plaintext highlighter-rouge">10.0.0.0/16</code>.</ul><h3 id="subnet-mysubnet"> <a href="#subnet-mysubnet" class="anchor-heading" aria-labelledby="subnet-mysubnet"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Subnet (<code class="language-plaintext highlighter-rouge">MySubnet</code>)</h3><ul><li>Creates a subnet within the VPC with the CIDR block <code class="language-plaintext highlighter-rouge">10.0.0.0/24</code>. The subnet is associated with the availability zone <code class="language-plaintext highlighter-rouge">us-east-1a</code>.</ul><h3 id="internet-gateway-myinternetgateway"> <a href="#internet-gateway-myinternetgateway" class="anchor-heading" aria-labelledby="internet-gateway-myinternetgateway"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Internet Gateway (<code class="language-plaintext highlighter-rouge">MyInternetGateway</code>)</h3><ul><li>Creates an Internet Gateway that enables internet connectivity for instances within the VPC.</ul><h3 id="vpc-gateway-attachment-myvpcgatewayattachment"> <a href="#vpc-gateway-attachment-myvpcgatewayattachment" class="anchor-heading" aria-labelledby="vpc-gateway-attachment-myvpcgatewayattachment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> VPC Gateway Attachment (<code class="language-plaintext highlighter-rouge">MyVPCGatewayAttachment</code>)</h3><ul><li>Attaches the Internet Gateway created above to the VPC.</ul><h3 id="route-table-myroutetable"> <a href="#route-table-myroutetable" class="anchor-heading" aria-labelledby="route-table-myroutetable"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Route Table (<code class="language-plaintext highlighter-rouge">MyRouteTable</code>)</h3><ul><li>Creates a route table associated with the VPC.</ul><h3 id="route-myroute"> <a href="#route-myroute" class="anchor-heading" aria-labelledby="route-myroute"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Route (<code class="language-plaintext highlighter-rouge">MyRoute</code>)</h3><ul><li>Adds a default route to the route table, directing all traffic (<code class="language-plaintext highlighter-rouge">0.0.0.0/0</code>) to the Internet Gateway.</ul><h3 id="subnet-route-table-association-mysubnetroutetableassociation"> <a href="#subnet-route-table-association-mysubnetroutetableassociation" class="anchor-heading" aria-labelledby="subnet-route-table-association-mysubnetroutetableassociation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Subnet Route Table Association (<code class="language-plaintext highlighter-rouge">MySubnetRouteTableAssociation</code>)</h3><ul><li>Associates the subnet with the route table, enabling internet access for instances in the subnet.</ul><h3 id="security-group-mysecuritygroup"> <a href="#security-group-mysecuritygroup" class="anchor-heading" aria-labelledby="security-group-mysecuritygroup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security Group (<code class="language-plaintext highlighter-rouge">MySecurityGroup</code>)</h3><ul><li>Creates a security group allowing SSH (TCP port 22) traffic from any IP (<code class="language-plaintext highlighter-rouge">0.0.0.0/0</code>). It is associated with the VPC.</ul><h3 id="ec2-instance-myinstance"> <a href="#ec2-instance-myinstance" class="anchor-heading" aria-labelledby="ec2-instance-myinstance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> EC2 Instance (<code class="language-plaintext highlighter-rouge">MyInstance</code>)</h3><ul><li>Creates an EC2 instance of type <code class="language-plaintext highlighter-rouge">t2.micro</code>, associated with the specified KeyPair and placed in the subnet created earlier. The instance uses the specified Amazon Machine Image (AMI) ID. It is also tagged with the name “instance-1”.</ul><h3 id="elastic-ip-myeip"> <a href="#elastic-ip-myeip" class="anchor-heading" aria-labelledby="elastic-ip-myeip"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Elastic IP (<code class="language-plaintext highlighter-rouge">MyEIP</code>)</h3><ul><li>Allocates an Elastic IP address to associate with the EC2 instance.</ul><h3 id="eip-association-myinstanceeipassociation"> <a href="#eip-association-myinstanceeipassociation" class="anchor-heading" aria-labelledby="eip-association-myinstanceeipassociation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> EIP Association (<code class="language-plaintext highlighter-rouge">MyInstanceEIPAssociation</code>)</h3><ul><li>Associates the Elastic IP with the EC2 instance, making it accessible with a static public IP address.</ul><h2 id="outputs"> <a href="#outputs" class="anchor-heading" aria-labelledby="outputs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Outputs</h2><ul><li><code class="language-plaintext highlighter-rouge">Instance1PublicIP</code>: This output displays the public IP address of the “instance-1” EC2 instance, allowing you to easily identify and connect to the instance via SSH.</ul><h2 id="test"> <a href="#test" class="anchor-heading" aria-labelledby="test"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test</h2><h3 id="to-test-it-out-ensure-to-ssh-into-the-public-ip-address"> <a href="#to-test-it-out-ensure-to-ssh-into-the-public-ip-address" class="anchor-heading" aria-labelledby="to-test-it-out-ensure-to-ssh-into-the-public-ip-address"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> To test it out, ensure to ssh into the public IP address</h3><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> <span class="s2">"Dev.pem"</span> ec2-user@public-IP-Address
</code></pre></div></div><h1 id="basic-infrastructure-that-provisions-a-nginx-server"> <a href="#basic-infrastructure-that-provisions-a-nginx-server" class="anchor-heading" aria-labelledby="basic-infrastructure-that-provisions-a-nginx-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Infrastructure that provisions a Nginx Server</h1><details> <summary>Provisioing the Basic Infrastructure by Creating a CloudFormation Stack</summary><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># Stack-4.yml</span>
<span class="na">AWSTemplateFormatVersion</span><span class="pi">:</span> <span class="s">2010-09-09</span>
<span class="na">Description</span><span class="pi">:</span> <span class="s">Basic Infrastructure CloudFormation Template with EC2 Instance</span>

<span class="na">Parameters</span><span class="pi">:</span>
  <span class="na">KeyName</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Name of an existing EC2 KeyPair to enable SSH access to the instance</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::KeyPair::KeyName</span>
    <span class="na">Default</span><span class="pi">:</span> <span class="s">Dev</span>
    
<span class="na">Resources</span><span class="pi">:</span>
  <span class="na">MyVPC</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPC</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/16"</span>
      <span class="na">EnableDnsSupport</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">EnableDnsHostnames</span><span class="pi">:</span> <span class="kc">true</span>

  <span class="na">MySubnet</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1a"</span>

  <span class="na">MyInternetGateway</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::InternetGateway</span>

  <span class="na">MyVPCGatewayAttachment</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">InternetGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MyRouteTable</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyRoute</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">MyVPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyRouteTable</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">GatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MySubnetRouteTableAssociation</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MySubnet</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyRouteTable</span>

  <span class="na">MySecurityGroup</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SecurityGroup</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">GroupDescription</span><span class="pi">:</span> <span class="s2">"</span><span class="s">My</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Group"</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">SecurityGroupIngress</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">IpProtocol</span><span class="pi">:</span> <span class="s">tcp</span>
          <span class="na">FromPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">ToPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">CidrIp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
        <span class="pi">-</span> <span class="na">IpProtocol</span><span class="pi">:</span> <span class="s">tcp</span>
          <span class="na">FromPort</span><span class="pi">:</span> <span class="m">80</span>
          <span class="na">ToPort</span><span class="pi">:</span> <span class="m">80</span>
          <span class="na">CidrIp</span><span class="pi">:</span> <span class="s">0.0.0.0/0</span>

  <span class="na">MyInstance</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Instance</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceType</span><span class="pi">:</span> <span class="s">t2.micro</span>
      <span class="na">NetworkInterfaces</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">GroupSet</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">MySecurityGroup</span>
          <span class="na">AssociatePublicIpAddress</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">DeviceIndex</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">DeleteOnTermination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MySubnet</span>
      <span class="na">KeyName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">KeyName</span>
      <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-97785bed"</span>
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">instance-1"</span>
      <span class="na">UserData</span><span class="pi">:</span>
        <span class="na">Fn::Base64</span><span class="pi">:</span> <span class="kt">!Sub</span> <span class="pi">|</span>
          <span class="s">#!/bin/bash</span>
          <span class="s">yum update -y</span>
          <span class="s">yum install -y nginx</span>

          <span class="s">echo "&lt;html&gt;&lt;body&gt;&lt;h1&gt;Welcome to My Website&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;" &gt;&gt; /var/www/html/index.html</span>
          <span class="s">echo "&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is my Second Page&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;" &gt;&gt; /var/www/html/second_page.html</span>
          <span class="s">service nginx start</span>

  <span class="na">MyEIP</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIP</span>

  <span class="na">MyInstanceEIPAssociation</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIPAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInstance</span>
      <span class="na">EIP</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyEIP</span>

<span class="na">Outputs</span><span class="pi">:</span>
  <span class="na">Instance1PublicIP</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Public IP Address of instance-1</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyInstance.PublicIp</span></code></pre></figure></details><ul><li>Test:<ul><li>Wait for a few minutes, go to the browser, enter public IP address</ul></ul><h1 id="basic-infrastructure-cloudformation-template-with-public-and-private-subnet-with-public-bastion-and-private-ec2-instance"> <a href="#basic-infrastructure-cloudformation-template-with-public-and-private-subnet-with-public-bastion-and-private-ec2-instance" class="anchor-heading" aria-labelledby="basic-infrastructure-cloudformation-template-with-public-and-private-subnet-with-public-bastion-and-private-ec2-instance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic Infrastructure CloudFormation Template with Public and Private Subnet with Public Bastion and Private EC2 Instance</h1><details> <summary>This CloudFormation Stack provisions basic infrastructure, with public and private subnets, along with public and private EC2 instances</summary><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">AWSTemplateFormatVersion</span><span class="pi">:</span> <span class="s">2010-09-09</span>
<span class="na">Description</span><span class="pi">:</span> <span class="s">Infrastructure CloudFormation Template with Bastion (Public), Private Subnets, NAT Gateway, and EC2 Instance</span>

<span class="na">Parameters</span><span class="pi">:</span>
  <span class="na">KeyName</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Name of an existing EC2 KeyPair to enable SSH access to the instance</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::KeyPair::KeyName</span>
    <span class="na">Default</span><span class="pi">:</span> <span class="s">Dev</span>

<span class="na">Resources</span><span class="pi">:</span>
  <span class="na">MyVPC</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPC</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/16"</span>
      <span class="na">EnableDnsSupport</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">EnableDnsHostnames</span><span class="pi">:</span> <span class="kc">true</span>

  <span class="na">MyPublicSubnet</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1a"</span>

  <span class="na">MyPrivateSubnet1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.1.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1b"</span>

  <span class="na">MyPrivateSubnet2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.2.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1c"</span>

  <span class="na">MyInternetGateway</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::InternetGateway</span>

  <span class="na">MyVPCGatewayAttachment</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">InternetGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MyPublicRouteTable</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyPublicRoute</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">MyVPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicRouteTable</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">GatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MyPublicSubnetRouteTableAssociation</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicRouteTable</span>

  <span class="na">MySecurityGroup</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SecurityGroup</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">GroupDescription</span><span class="pi">:</span> <span class="s2">"</span><span class="s">My</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Group"</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">SecurityGroupIngress</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">IpProtocol</span><span class="pi">:</span> <span class="s">tcp</span>
          <span class="na">FromPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">ToPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">CidrIp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>

  <span class="na">MyBastionInstance</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Instance</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceType</span><span class="pi">:</span> <span class="s">t2.micro</span>
      <span class="na">KeyName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">KeyName</span>
      <span class="na">NetworkInterfaces</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">GroupSet</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">MySecurityGroup</span>
          <span class="na">AssociatePublicIpAddress</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">DeviceIndex</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">DeleteOnTermination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>
      <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-97785bed"</span>
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bastion-instance"</span>

  <span class="na">MyPrivateRouteTable1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyPrivateRoute1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable1</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">NatGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyNatGateway1</span>

  <span class="na">MyPrivateSubnetRouteTableAssociation1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSubnet1</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable1</span>

  <span class="na">MyPrivateRouteTable2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyPrivateRoute2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable2</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">NatGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyNatGateway2</span>

  <span class="na">MyPrivateSubnetRouteTableAssociation2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSubnet2</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable2</span>

  <span class="na">MyNatGateway1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::NatGateway</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">AllocationId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyEIP1.AllocationId</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>

  <span class="na">MyNatGateway2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::NatGateway</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">AllocationId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyEIP2.AllocationId</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>

  <span class="na">MyEIP1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIP</span>

  <span class="na">MyEIP2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIP</span>

  <span class="na">MyPrivateSecurityGroup</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SecurityGroup</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">GroupDescription</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Private</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Group"</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">SecurityGroupIngress</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">IpProtocol</span><span class="pi">:</span> <span class="s">tcp</span>
          <span class="na">FromPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">ToPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">CidrIp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>

  <span class="na">MyPrivateEC2Instance</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Instance</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceType</span><span class="pi">:</span> <span class="s">t2.micro</span>
      <span class="na">KeyName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">KeyName</span>
      <span class="na">NetworkInterfaces</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">GroupSet</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSecurityGroup</span>
          <span class="na">DeviceIndex</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">DeleteOnTermination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSubnet1</span>
      <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-97785bed"</span>
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">private-instance"</span>

<span class="na">Outputs</span><span class="pi">:</span>
  <span class="na">Instance1PublicIP</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Public IP Address of bastion-instance (instance-1)</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyBastionInstance.PublicIp</span>

  <span class="na">PrivateInstance1PrivateIP</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Private IP Address of private-instance-1</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyPrivateEC2Instance.PrivateIp</span></code></pre></figure></details><h2 id="parameters-1"> <a href="#parameters-1" class="anchor-heading" aria-labelledby="parameters-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Parameters</h2><ul><li><code class="language-plaintext highlighter-rouge">KeyName</code>: This parameter allows you to specify the name of an existing EC2 KeyPair to enable SSH access to the instances. The default value is set to <code class="language-plaintext highlighter-rouge">Dev</code>.</ul><h2 id="resources-1"> <a href="#resources-1" class="anchor-heading" aria-labelledby="resources-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Resources</h2><h3 id="vpc-myvpc-1"> <a href="#vpc-myvpc-1" class="anchor-heading" aria-labelledby="vpc-myvpc-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> VPC (<code class="language-plaintext highlighter-rouge">MyVPC</code>)</h3><ul><li>Creates a Virtual Private Cloud (VPC) with the CIDR block <code class="language-plaintext highlighter-rouge">10.0.0.0/16</code>.</ul><h3 id="public-subnet-mypublicsubnet"> <a href="#public-subnet-mypublicsubnet" class="anchor-heading" aria-labelledby="public-subnet-mypublicsubnet"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Public Subnet (<code class="language-plaintext highlighter-rouge">MyPublicSubnet</code>)</h3><ul><li>Creates a public subnet within the VPC with the CIDR block <code class="language-plaintext highlighter-rouge">10.0.0.0/24</code>. This subnet is associated with the availability zone <code class="language-plaintext highlighter-rouge">us-east-1a</code>.</ul><h3 id="private-subnet-1-myprivatesubnet1"> <a href="#private-subnet-1-myprivatesubnet1" class="anchor-heading" aria-labelledby="private-subnet-1-myprivatesubnet1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Subnet 1 (<code class="language-plaintext highlighter-rouge">MyPrivateSubnet1</code>)</h3><ul><li>Creates the first private subnet within the VPC with the CIDR block <code class="language-plaintext highlighter-rouge">10.0.1.0/24</code>. This subnet is associated with the availability zone <code class="language-plaintext highlighter-rouge">us-east-1b</code>.</ul><h3 id="private-subnet-2-myprivatesubnet2"> <a href="#private-subnet-2-myprivatesubnet2" class="anchor-heading" aria-labelledby="private-subnet-2-myprivatesubnet2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Subnet 2 (<code class="language-plaintext highlighter-rouge">MyPrivateSubnet2</code>)</h3><ul><li>Creates the second private subnet within the VPC with the CIDR block <code class="language-plaintext highlighter-rouge">10.0.2.0/24</code>. This subnet is associated with the availability zone <code class="language-plaintext highlighter-rouge">us-east-1c</code>.</ul><h3 id="internet-gateway-myinternetgateway-1"> <a href="#internet-gateway-myinternetgateway-1" class="anchor-heading" aria-labelledby="internet-gateway-myinternetgateway-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Internet Gateway (<code class="language-plaintext highlighter-rouge">MyInternetGateway</code>)</h3><ul><li>Creates an Internet Gateway that enables internet connectivity for instances within the VPC.</ul><h3 id="vpc-gateway-attachment-myvpcgatewayattachment-1"> <a href="#vpc-gateway-attachment-myvpcgatewayattachment-1" class="anchor-heading" aria-labelledby="vpc-gateway-attachment-myvpcgatewayattachment-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> VPC Gateway Attachment (<code class="language-plaintext highlighter-rouge">MyVPCGatewayAttachment</code>)</h3><ul><li>Attaches the Internet Gateway created above to the VPC.</ul><h3 id="public-route-table-mypublicroutetable"> <a href="#public-route-table-mypublicroutetable" class="anchor-heading" aria-labelledby="public-route-table-mypublicroutetable"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Public Route Table (<code class="language-plaintext highlighter-rouge">MyPublicRouteTable</code>)</h3><ul><li>Creates a public route table associated with the VPC.</ul><h3 id="public-route-mypublicroute"> <a href="#public-route-mypublicroute" class="anchor-heading" aria-labelledby="public-route-mypublicroute"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Public Route (<code class="language-plaintext highlighter-rouge">MyPublicRoute</code>)</h3><ul><li>Adds a default route to the public route table, directing all traffic (<code class="language-plaintext highlighter-rouge">0.0.0.0/0</code>) to the Internet Gateway.</ul><h3 id="public-subnet-route-table-association-mypublicsubnetroutetableassociation"> <a href="#public-subnet-route-table-association-mypublicsubnetroutetableassociation" class="anchor-heading" aria-labelledby="public-subnet-route-table-association-mypublicsubnetroutetableassociation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Public Subnet Route Table Association (<code class="language-plaintext highlighter-rouge">MyPublicSubnetRouteTableAssociation</code>)</h3><ul><li>Associates the public subnet with the public route table, enabling internet access for instances in the public subnet.</ul><h3 id="security-group-mysecuritygroup-1"> <a href="#security-group-mysecuritygroup-1" class="anchor-heading" aria-labelledby="security-group-mysecuritygroup-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Security Group (<code class="language-plaintext highlighter-rouge">MySecurityGroup</code>)</h3><ul><li>Creates a security group allowing SSH (TCP port 22) traffic from any IP (<code class="language-plaintext highlighter-rouge">0.0.0.0/0</code>). It is associated with the VPC and used for the bastion (public) instance.</ul><h3 id="bastion-public-ec2-instance-mybastioninstance"> <a href="#bastion-public-ec2-instance-mybastioninstance" class="anchor-heading" aria-labelledby="bastion-public-ec2-instance-mybastioninstance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bastion (Public) EC2 Instance (<code class="language-plaintext highlighter-rouge">MyBastionInstance</code>)</h3><ul><li>Creates a bastion (public) EC2 instance of type <code class="language-plaintext highlighter-rouge">t2.micro</code>, associated with the specified KeyPair, placed in the public subnet, and allocated a public IP address. The instance uses the specified Amazon Machine Image (AMI) ID and is tagged with the name “bastion-instance”.</ul><h3 id="private-route-table-1-myprivateroutetable1"> <a href="#private-route-table-1-myprivateroutetable1" class="anchor-heading" aria-labelledby="private-route-table-1-myprivateroutetable1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Route Table 1 (<code class="language-plaintext highlighter-rouge">MyPrivateRouteTable1</code>)</h3><ul><li>Creates the first private route table associated with the VPC.</ul><h3 id="private-route-1-myprivateroute1"> <a href="#private-route-1-myprivateroute1" class="anchor-heading" aria-labelledby="private-route-1-myprivateroute1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Route 1 (<code class="language-plaintext highlighter-rouge">MyPrivateRoute1</code>)</h3><ul><li>Adds a default route to the first private route table, directing all traffic (<code class="language-plaintext highlighter-rouge">0.0.0.0/0</code>) to the NAT Gateway for the first private subnet.</ul><h3 id="private-subnet-1-route-table-association-myprivatesubnetroutetableassociation1"> <a href="#private-subnet-1-route-table-association-myprivatesubnetroutetableassociation1" class="anchor-heading" aria-labelledby="private-subnet-1-route-table-association-myprivatesubnetroutetableassociation1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Subnet 1 Route Table Association (<code class="language-plaintext highlighter-rouge">MyPrivateSubnetRouteTableAssociation1</code>)</h3><ul><li>Associates the first private subnet with the first private route table.</ul><h3 id="private-route-table-2-myprivateroutetable2"> <a href="#private-route-table-2-myprivateroutetable2" class="anchor-heading" aria-labelledby="private-route-table-2-myprivateroutetable2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Route Table 2 (<code class="language-plaintext highlighter-rouge">MyPrivateRouteTable2</code>)</h3><ul><li>Creates the second private route table associated with the VPC.</ul><h3 id="private-route-2-myprivateroute2"> <a href="#private-route-2-myprivateroute2" class="anchor-heading" aria-labelledby="private-route-2-myprivateroute2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Route 2 (<code class="language-plaintext highlighter-rouge">MyPrivateRoute2</code>)</h3><ul><li>Adds a default route to the second private route table, directing all traffic (<code class="language-plaintext highlighter-rouge">0.0.0.0/0</code>) to the NAT Gateway for the second private subnet.</ul><h3 id="private-subnet-2-route-table-association-myprivatesubnetroutetableassociation2"> <a href="#private-subnet-2-route-table-association-myprivatesubnetroutetableassociation2" class="anchor-heading" aria-labelledby="private-subnet-2-route-table-association-myprivatesubnetroutetableassociation2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Subnet 2 Route Table Association (<code class="language-plaintext highlighter-rouge">MyPrivateSubnetRouteTableAssociation2</code>)</h3><ul><li>Associates the second private subnet with the second private route table.</ul><h3 id="nat-gateway-1-mynatgateway1"> <a href="#nat-gateway-1-mynatgateway1" class="anchor-heading" aria-labelledby="nat-gateway-1-mynatgateway1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> NAT Gateway 1 (<code class="language-plaintext highlighter-rouge">MyNatGateway1</code>)</h3><ul><li>Creates the first NAT Gateway associated with the public subnet. It allows instances in the first private subnet to access the internet.</ul><h3 id="nat-gateway-2-mynatgateway2"> <a href="#nat-gateway-2-mynatgateway2" class="anchor-heading" aria-labelledby="nat-gateway-2-mynatgateway2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> NAT Gateway 2 (<code class="language-plaintext highlighter-rouge">MyNatGateway2</code>)</h3><ul><li>Creates the second NAT Gateway associated with the public subnet. It allows instances in the second private subnet to access the internet.</ul><h3 id="elastic-ip-1-myeip1"> <a href="#elastic-ip-1-myeip1" class="anchor-heading" aria-labelledby="elastic-ip-1-myeip1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Elastic IP 1 (<code class="language-plaintext highlighter-rouge">MyEIP1</code>)</h3><ul><li>Allocates an Elastic IP address for the first NAT Gateway.</ul><h3 id="elastic-ip-2-myeip2"> <a href="#elastic-ip-2-myeip2" class="anchor-heading" aria-labelledby="elastic-ip-2-myeip2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Elastic IP 2 (<code class="language-plaintext highlighter-rouge">MyEIP2</code>)</h3><ul><li>Allocates an Elastic IP address for the second NAT Gateway.</ul><h3 id="private-security-group-myprivatesecuritygroup"> <a href="#private-security-group-myprivatesecuritygroup" class="anchor-heading" aria-labelledby="private-security-group-myprivatesecuritygroup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private Security Group (<code class="language-plaintext highlighter-rouge">MyPrivateSecurityGroup</code>)</h3><ul><li>Creates a security group allowing SSH (TCP port 22) traffic from any IP (<code class="language-plaintext highlighter-rouge">0.0.0.0/0</code>). It is associated with the VPC and used for the private EC2 instance.</ul><h3 id="private-ec2-instance-myprivateec2instance"> <a href="#private-ec2-instance-myprivateec2instance" class="anchor-heading" aria-labelledby="private-ec2-instance-myprivateec2instance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Private EC2 Instance (<code class="language-plaintext highlighter-rouge">MyPrivateEC2Instance</code>)</h3><ul><li>Creates a private EC2 instance of type <code class="language-plaintext highlighter-rouge">t2.micro</code>, associated with the specified KeyPair, placed in the first private subnet, and allocated a private IP address. The instance uses the specified Amazon Machine Image (AMI) ID and is tagged with the name “private-instance”.</ul><h2 id="outputs-1"> <a href="#outputs-1" class="anchor-heading" aria-labelledby="outputs-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Outputs</h2><ul><li><code class="language-plaintext highlighter-rouge">Instance1PublicIP</code>: This output displays the public IP address of the bastion (public) instance (<code class="language-plaintext highlighter-rouge">MyBastionInstance</code>). You can use this IP address to SSH into the bastion instance.<li><code class="language-plaintext highlighter-rouge">PrivateInstance1PrivateIP</code>: This output displays the private IP address of the private EC2 instance (<code class="language-plaintext highlighter-rouge">MyPrivateEC2Instance</code>). You can use this IP address to access the private EC2 instance within the private subnets.</ul><h2 id="test-1"> <a href="#test-1" class="anchor-heading" aria-labelledby="test-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Test</h2><h3 id="to-test-it-out-ensure-to-ssh-into-the-public-ip-address-1"> <a href="#to-test-it-out-ensure-to-ssh-into-the-public-ip-address-1" class="anchor-heading" aria-labelledby="to-test-it-out-ensure-to-ssh-into-the-public-ip-address-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> To test it out, ensure to ssh into the public IP address</h3><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## SSH into the public EC2 instance</span>
ssh <span class="nt">-i</span> <span class="s2">"Dev.pem"</span> ec2-user@public-IP-address

<span class="c">## Get the copy of Dev.pem</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">&gt; Dev.pem
-----BEGIN RSA PRIVATE KEY-----
dscjdnsjkcdsncjks 
-------END RSA PRIVATE KEY-------
</span><span class="no">EOF

</span><span class="nb">chmod </span>400 Dev.pem

ssh <span class="nt">-i</span> <span class="s2">"Dev.pem"</span> ec2-user@private-IP-address
</code></pre></div></div><h1 id="create-2-more-private-ec2-insntaces"> <a href="#create-2-more-private-ec2-insntaces" class="anchor-heading" aria-labelledby="create-2-more-private-ec2-insntaces"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create 2 More Private EC2 Insntaces</h1><details> <summary>This CloudFormation Stack provisions basic infrastructure, with public and private subnets, along with public and private EC2 instances, Plus two more private EC2 instancesqqus</summary><figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">AWSTemplateFormatVersion</span><span class="pi">:</span> <span class="s">2010-09-09</span>
<span class="na">Description</span><span class="pi">:</span> <span class="s">Infrastructure CloudFormation Template with Bastion (Public), Private Subnets, NAT Gateway, and EC2 Instance</span>

<span class="na">Parameters</span><span class="pi">:</span>
  <span class="na">KeyName</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Name of an existing EC2 KeyPair to enable SSH access to the instance</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::KeyPair::KeyName</span>
    <span class="na">Default</span><span class="pi">:</span> <span class="s">Dev</span>

<span class="na">Resources</span><span class="pi">:</span>
  <span class="na">MyVPC</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPC</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/16"</span>
      <span class="na">EnableDnsSupport</span><span class="pi">:</span> <span class="kc">true</span>
      <span class="na">EnableDnsHostnames</span><span class="pi">:</span> <span class="kc">true</span>

  <span class="na">MyPublicSubnet</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1a"</span>

  <span class="na">MyPrivateSubnet1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.1.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1b"</span>

  <span class="na">MyPrivateSubnet2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Subnet</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">CidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.2.0/24"</span>
      <span class="na">AvailabilityZone</span><span class="pi">:</span> <span class="s2">"</span><span class="s">us-east-1c"</span>

  <span class="na">MyInternetGateway</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::InternetGateway</span>

  <span class="na">MyVPCGatewayAttachment</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::VPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">InternetGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MyPublicRouteTable</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyPublicRoute</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">DependsOn</span><span class="pi">:</span> <span class="s">MyVPCGatewayAttachment</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicRouteTable</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">GatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyInternetGateway</span>

  <span class="na">MyPublicSubnetRouteTableAssociation</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicRouteTable</span>

  <span class="na">MySecurityGroup</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SecurityGroup</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">GroupDescription</span><span class="pi">:</span> <span class="s2">"</span><span class="s">My</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Group"</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">SecurityGroupIngress</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">IpProtocol</span><span class="pi">:</span> <span class="s">tcp</span>
          <span class="na">FromPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">ToPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">CidrIp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>

  <span class="na">MyBastionInstance</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Instance</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceType</span><span class="pi">:</span> <span class="s">t2.micro</span>
      <span class="na">KeyName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">KeyName</span>
      <span class="na">NetworkInterfaces</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">GroupSet</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">MySecurityGroup</span>
          <span class="na">AssociatePublicIpAddress</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">DeviceIndex</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">DeleteOnTermination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>
      <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-97785bed"</span>
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bastion-instance"</span>

  <span class="na">MyPrivateRouteTable1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyPrivateRoute1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable1</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">NatGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyNatGateway1</span>

  <span class="na">MyPrivateSubnetRouteTableAssociation1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSubnet1</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable1</span>

  <span class="na">MyPrivateRouteTable2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::RouteTable</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>

  <span class="na">MyPrivateRoute2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Route</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable2</span>
      <span class="na">DestinationCidrBlock</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>
      <span class="na">NatGatewayId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyNatGateway2</span>

  <span class="na">MyPrivateSubnetRouteTableAssociation2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SubnetRouteTableAssociation</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSubnet2</span>
      <span class="na">RouteTableId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateRouteTable2</span>

  <span class="na">MyNatGateway1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::NatGateway</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">AllocationId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyEIP1.AllocationId</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>

  <span class="na">MyNatGateway2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::NatGateway</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">AllocationId</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyEIP2.AllocationId</span>
      <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPublicSubnet</span>

  <span class="na">MyEIP1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIP</span>

  <span class="na">MyEIP2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::EIP</span>

  <span class="na">MyPrivateSecurityGroup</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::SecurityGroup</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">GroupDescription</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Private</span><span class="nv"> </span><span class="s">Security</span><span class="nv"> </span><span class="s">Group"</span>
      <span class="na">VpcId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyVPC</span>
      <span class="na">SecurityGroupIngress</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">IpProtocol</span><span class="pi">:</span> <span class="s">tcp</span>
          <span class="na">FromPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">ToPort</span><span class="pi">:</span> <span class="m">22</span>
          <span class="na">CidrIp</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0.0.0.0/0"</span>

  <span class="na">MyPrivateEC2Instance1</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Instance</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceType</span><span class="pi">:</span> <span class="s">t2.micro</span>
      <span class="na">KeyName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">KeyName</span>
      <span class="na">NetworkInterfaces</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">GroupSet</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSecurityGroup</span>
          <span class="na">DeviceIndex</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">DeleteOnTermination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSubnet1</span>
      <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-97785bed"</span>
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">private-instance-1"</span>

  <span class="na">MyPrivateEC2Instance2</span><span class="pi">:</span>
    <span class="na">Type</span><span class="pi">:</span> <span class="s">AWS::EC2::Instance</span>
    <span class="na">Properties</span><span class="pi">:</span>
      <span class="na">InstanceType</span><span class="pi">:</span> <span class="s">t2.micro</span>
      <span class="na">KeyName</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">KeyName</span>
      <span class="na">NetworkInterfaces</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">GroupSet</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSecurityGroup</span>
          <span class="na">DeviceIndex</span><span class="pi">:</span> <span class="m">0</span>
          <span class="na">DeleteOnTermination</span><span class="pi">:</span> <span class="kc">true</span>
          <span class="na">SubnetId</span><span class="pi">:</span> <span class="kt">!Ref</span> <span class="s">MyPrivateSubnet2</span>
      <span class="na">ImageId</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ami-97785bed"</span>
      <span class="na">Tags</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">Key</span><span class="pi">:</span> <span class="s">Name</span>
          <span class="na">Value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">private-instance-2"</span>
<span class="na">Outputs</span><span class="pi">:</span>
  <span class="na">Instance1PublicIP</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Public IP Address of bastion-instance (instance-1)</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyBastionInstance.PublicIp</span>

  <span class="na">PrivateInstance1PrivateIP</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Private IP Address of private-instance-1</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyPrivateEC2Instance1.PrivateIp</span>

  <span class="na">PrivateInstance2PrivateIP</span><span class="pi">:</span>
    <span class="na">Description</span><span class="pi">:</span> <span class="s">Private IP Address of private-instance-2</span>
    <span class="na">Value</span><span class="pi">:</span> <span class="kt">!GetAtt</span> <span class="s">MyPrivateEC2Instance2.PrivateIp</span></code></pre></figure></details><h2 id="building-smailler-images-with-multi-stage-builds"> <a href="#building-smailler-images-with-multi-stage-builds" class="anchor-heading" aria-labelledby="building-smailler-images-with-multi-stage-builds"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Building Smailler Images with Multi-stage builds</h2><h3 id="containers-are-made-of-layers-compile-and-install-operations-performed-in-the-image-add-to-the-layers-increasing-the-size-of-the-containerinstead-of-keeping-all-of-those-layers-into-the-final-image-you-can-split-those-steps-off-and-only-use-the-finished-product-docker-provides-this-capability-through-multi-stage-builds"> <a href="#containers-are-made-of-layers-compile-and-install-operations-performed-in-the-image-add-to-the-layers-increasing-the-size-of-the-containerinstead-of-keeping-all-of-those-layers-into-the-final-image-you-can-split-those-steps-off-and-only-use-the-finished-product-docker-provides-this-capability-through-multi-stage-builds" class="anchor-heading" aria-labelledby="containers-are-made-of-layers-compile-and-install-operations-performed-in-the-image-add-to-the-layers-increasing-the-size-of-the-containerinstead-of-keeping-all-of-those-layers-into-the-final-image-you-can-split-those-steps-off-and-only-use-the-finished-product-docker-provides-this-capability-through-multi-stage-builds"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Containers are made of layers. Compile and install operations performed in the image, add to the layers, increasing the size of the container.Instead of keeping all of those layers into the final image, you can split those steps off, and only use the finished product. Docker provides this capability through multi-stage builds</h3><h4 id="key-points"> <a href="#key-points" class="anchor-heading" aria-labelledby="key-points"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Points</h4><ul><li>docker inspect “-f” parameter gives format (parses) the value from the inspect of the docker containers<li>“numfmt –to=iec” converts bytes to gigabytes<li>From Dockerfile, certain pieces of lines of scripts are pulled to the side (layer) and added into the image, producing fewer layers (outputs) in the images<li>Beginning of the Dockerfile: FROM python:3 AS BASE<li>“FROM base AS builder”<li>Then the new layer of the image begins</ul><details> <summary>Script Example</summary><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Do Prep Work in the Image</span>

<span class="c">## Change to the notes directory:</span>
<span class="nb">cd </span>notes

<span class="c">## Check the Dockerfile:</span>
<span class="nb">cat </span>Dockerfile

<span class="c">## Build an image using the file:</span>
docker build <span class="nt">-t</span> notesapp:default <span class="nb">.</span>

<span class="c">## Set a variable to view the layers of the image:</span>
<span class="c">## Formats the output of a docker inspect to give the hashes of the layers used for the image.</span>
<span class="nb">export </span><span class="nv">showLayers</span><span class="o">=</span><span class="s1">'{{ range .RootFS.Layers }}{{ println . }}{{end}}'</span>

<span class="c">## Set a variable to show the size of the image:</span>
<span class="nb">export </span><span class="nv">showSize</span><span class="o">=</span><span class="s1">'{{ .Size }}'</span>

<span class="c">## Show the image layers:</span>
docker inspect <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$showLayers</span><span class="s2">"</span> notesapp:default

<span class="c">## Count the number of layers:</span>
docker inspect <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$showLayers</span><span class="s2">"</span> notesapp:default | <span class="nb">wc</span> <span class="nt">-l</span>

<span class="c">## Show the size of the image:</span>
docker inspect <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$showSize</span><span class="s2">"</span> notesapp:default | <span class="nb">numfmt</span> <span class="nt">--to</span><span class="o">=</span>iec

<span class="c"># Add a Build Stage</span>

<span class="c">## Open the Dockerfile:</span>
vim Dockerfile
Add a build stage by adding the following:
FROM python:3 AS base
ENV PYBASE /pybase
ENV PYTHONUSERBASE <span class="nv">$PYBASE</span>
ENV PATH <span class="nv">$PYBASE</span>/bin:<span class="nv">$PATH</span>

FROM base AS builder
RUN pip <span class="nb">install </span>pipenv
WORKDIR /tmp
COPY Pipfile <span class="nb">.</span>
RUN pipenv lock
RUN <span class="nv">PIP_USER</span><span class="o">=</span>1 <span class="nv">PIP_IGNORE_INSTALLED</span><span class="o">=</span>1 pipenv <span class="nb">install</span> <span class="nt">-d</span> <span class="nt">--system</span> <span class="nt">--ignore-pipfile</span>

FROM base
COPY <span class="nt">--from</span><span class="o">=</span>builder /pybase /pybase
COPY <span class="nb">.</span> /app/notes
WORKDIR /app/notes
EXPOSE 80
CMD <span class="o">[</span> <span class="s2">"flask"</span>, <span class="s2">"run"</span>, <span class="s2">"--port=80"</span>, <span class="s2">"--host=0.0.0.0"</span> <span class="o">]</span>

<span class="c">## Save the file:</span>
ESC
:wq

<span class="c"># Create a Smaller Image</span>

<span class="c">## Build the image:</span>
docker build <span class="nt">-t</span> notesapp:multistage <span class="nb">.</span>

<span class="c">## Show the multistage image layers:</span>
docker inspect <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$showLayers</span><span class="s2">"</span> notesapp:multistage

<span class="c">## Count the layers:</span>
docker inspect <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$showLayers</span><span class="s2">"</span> notesapp:multistage | <span class="nb">wc</span> <span class="nt">-l</span>

<span class="c">## Show the size of the image:</span>
docker inspect <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$showSize</span><span class="s2">"</span> notesapp:multistage | <span class="nb">numfmt</span> <span class="nt">--to</span><span class="o">=</span>iec</code></pre></figure></details><hr style="3px solid #bbb" /><h2 id="container-logging"> <a href="#container-logging" class="anchor-heading" aria-labelledby="container-logging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Container Logging</h2><h3 id="congifure-syslog-to-use-udp-and-then-configure-docker-to-use-the-syslog-logging-driver-by-default"> <a href="#congifure-syslog-to-use-udp-and-then-configure-docker-to-use-the-syslog-logging-driver-by-default" class="anchor-heading" aria-labelledby="congifure-syslog-to-use-udp-and-then-configure-docker-to-use-the-syslog-logging-driver-by-default"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Congifure syslog to use UDP and then configure Docker to use the syslog logging driver by default</h3><details> <summary>Script Example</summary><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#  Configure Docker to Use Syslog</span>
<span class="c">## Open the rsyslog.conf file.</span>
vim /etc/rsyslog.conf

<span class="c">## In the file editor, uncomment the two lines under Provides UDP syslog reception by removing #.</span>

<span class="nv">$ModLoad</span> imudp
<span class="nv">$UDPServerRun</span> 514

<span class="c">## Then, start the syslog service.</span>

systemctl start rsyslog

<span class="c">## Now that syslog is running, let's configure Docker to use syslog as the default logging driver. We'll do this by creating a file called daemon.json.</span>

<span class="nb">mkdir</span> /etc/docker
vi /etc/docker/daemon.json

<span class="c">## In the vi editor, enter the following, making sure to replace &lt;PRIVATE_IP&gt; with the private IP of your cloud server:</span>

<span class="o">{</span>
  <span class="s2">"log-driver"</span>: <span class="s2">"syslog"</span>,
  <span class="s2">"log-opts"</span>: <span class="o">{</span>
    <span class="s2">"syslog-address"</span>: <span class="s2">"udp://&lt;PRIVATE_IP&gt;:514"</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c">## Next, save and quit. Then, start the Docker service.</span>

systemctl start docker

<span class="c">## The next step is to see if there are any logs coming in from Docker.</span>

<span class="nb">tail</span> /var/log/messages

<span class="c">## The output of this command tells us that there are. Now let's test our setup.</span>

<span class="c">## We're going to create two new containers using the httpd image. The first one will be called syslog-logging and will use none for the log driver. The second will be called json-logging and will use the JSON file for the log driver.</span>

<span class="c">## Create a container.</span>

docker container run <span class="nt">-d</span> <span class="nt">--name</span> syslog-logging <span class="nt">--log-driver</span> none httpd

<span class="c">## Then run docker ps to make sure our container is up and running correctly. Then, execute the docker logs command to see what logs we have.</span>

docker logs syslog-logging

<span class="c">## To confirm that we are logging to syslog, we can check the content of /var/log/messages. Verify that the syslog-logging container is sending its logs to syslog by running tail on the message log file.</span>

<span class="nb">tail</span> /var/log/messages

<span class="c">## The output shows us the logs that are being input to syslog.Create our second test container. This time, we'll specify the log driver as the JSON file.</span>

docker container run <span class="nt">-d</span> <span class="nt">--name</span> json-logging <span class="nt">--log-driver</span> json-file httpd

<span class="c">## Run the docker ps command again. This time, we should see two containers running. Verify that the json-logging container is sending its logs to the JSON file. Execute the docker logs command on the json-logging container.</span>

docker logs json-logging
This <span class="nb">time</span>, the logs <span class="k">do </span>not appear <span class="k">in</span> /var/log/messages because they are being sent to a JSON file instead.</code></pre></figure></details><hr style="3px solid #bbb" /></main><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><span>[ <a href="https://github.com/kyoon55">Github</a> ]</span> <span>[ <a href="mailto:kyoon5@gwu.edu">Click here to email me</a> ]</span><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/my-tech/assets/css/just-the-docs-default.css"> <script src="/my-tech/assets/js/vendor/lunr.min.js"></script> <script src="/my-tech/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/my-tech/assets/images/favicon.ico" type="image/x-icon"><title>CloudFormation Stack Deployment Examples Part 1 | My SRE Stuff</title><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="CloudFormation Stack Deployment Examples Part 1" /><meta property="og:locale" content="en_US" /><meta name="description" content="List of CloudFormation Stack Deployments for AWS resources" /><meta property="og:description" content="List of CloudFormation Stack Deployments for AWS resources" /><link rel="canonical" href="http://localhost:4000/my-tech/doc/AWS/creation-of-basic-infra/" /><meta property="og:url" content="http://localhost:4000/my-tech/doc/AWS/creation-of-basic-infra/" /><meta property="og:site_name" content="My SRE Stuff" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-05-03T00:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CloudFormation Stack Deployment Examples Part 1" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-03T00:00:00-04:00","datePublished":"2023-05-03T00:00:00-04:00","description":"List of CloudFormation Stack Deployments for AWS resources","headline":"CloudFormation Stack Deployment Examples Part 1","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/my-tech/doc/AWS/creation-of-basic-infra/"},"url":"http://localhost:4000/my-tech/doc/AWS/creation-of-basic-infra/"}</script>
