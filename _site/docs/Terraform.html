<!DOCTYPE html><html lang="en-US"><body> <script> var elements = document.querySelectorAll('p'); Array.prototype.forEach.call(elements, function(el, i){ if(el.innerHTML=='[expand]') { var parentcontent = el.parentNode.innerHTML.replace('<p>[expand]</p>','<div class="expand" style="display: none; height: 0; overflow: hidden;">').replace('<p>[/expand]</p>','</div>'); el.parentNode.innerHTML = parentcontent; } }); var elements = document.querySelectorAll('div.expand'); Array.prototype.forEach.call(elements, function(el, i){ el.previousElementSibling.innerHTML = el.previousElementSibling.innerHTML + '<span>..&nbsp; <a href="#" style="cursor: pointer;" onclick="this.parentNode.parentNode.nextElementSibling.style.display = \'block\'; this.parentNode.parentNode.nextElementSibling.style.height = \'auto\'; this.parentNode.style.display = \'none\';">read&nbsp;more&nbsp;&rarr;</a></span>'; }); </script> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/my-tech/" class="site-title lh-tight"> My SRE Stuff </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/my-tech/" class="nav-list-link">My Page</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in AWS category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/AWS" class="nav-list-link">AWS</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/AWS/creation-of-basic-infra/" class="nav-list-link">CloudFormation Stack Deployment Examples Part 1</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Ansible category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Ansible" class="nav-list-link">Ansible</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Ansible/ansible-1/" class="nav-list-link">Create a host, ssh into the public EC2 instnace</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in CICD category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/CICD" class="nav-list-link">CICD</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Docker category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Docker" class="nav-list-link">Docker</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Docker/docker-1/" class="nav-list-link">Docker First Setup From A Cloud Guru Part 1</a><li class="nav-list-item "><a href="/my-tech/doc/Docker/docker-2/" class="nav-list-link">Docker First Setup From A Cloud Guru Part 2</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Kubernetes category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Kubernetes" class="nav-list-link">Kubernetes</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Kubernetes/doc-1/" class="nav-list-link">Kubernetes 1.24 Installation</a><li class="nav-list-item "><a href="/my-tech/doc/Kubernetes/doc-2/" class="nav-list-link">CKA Preparation</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Misc category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Misc" class="nav-list-link">Misc</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/doc/Misc/template/" class="nav-list-link">tutorial about the running a sample docker image in numbered steps</a><li class="nav-list-item "><a href="/my-tech/template/" class="nav-list-link">Title</a><li class="nav-list-item "><a href="/my-tech/doc/Misc/tutorial-about-the-running-a-sample-docker-image-in-numbered-steps%20copy/" class="nav-list-link">tutorial about the running a sample docker image in numbered steps</a><li class="nav-list-item "><a href="/my-tech/doc/Misc/a-tutorial-about-creating-an-AWS-basic-infrastructure,-with-VPC,-publicc,-and-private-subnets,-IGW,-NAT,-security-groups,-EC2-and-RDS-that-runs-postgresql/" class="nav-list-link">a tutorial about creating an AWS basic infrastructure, with VPC, public, and private subnets, IGW, NAT, security groups, EC2 and RDS that runs postgresql</a></ul><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in Terraform category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/my-tech/docs/Terraform" class="nav-list-link active">Terraform</a><ul class="nav-list"><li class="nav-list-item "><a href="/my-tech/docs/Terraform/doc-1/" class="nav-list-link">Terraform Deployment of basic infrastructure on AWS</a></ul></ul></nav></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search My SRE Stuff" aria-label="Search My SRE Stuff" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content"><main><h1> Terraform</h1><h2></h2><h3> Date Posted: 2023 02 25</h3><h2 id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents</h2><ul><li><a href="#table-of-contents">Table of Contents</a><li><a href="#terraform-architecture">Terraform Architecture</a><li><a href="#installation">Installation</a><ul><li><a href="#windows">Windows</a><li><a href="#linux-ubuntu-package-manager">Linux (Ubuntu) Package Manager</a><li><a href="#macos-package-manager">macOS Package Manager</a></ul><li><a href="#terraform-cli">Terraform CLI</a><ul><li><a href="#terraform-version">terraform version</a><li><a href="#terraform--install-autocomplete">terraform -install-autocomplete</a><li><a href="#terraform-fmt">terraform fmt</a><ul><li><a href="#options">Options</a></ul><li><a href="#terraform-validate">terraform validate</a><li><a href="#terraform-providers">terraform providers</a><li><a href="#terraform-init">terraform init</a><li><a href="#terraform-plan">terraform plan</a><li><a href="#terraform-apply">terraform apply</a><ul><li><a href="#examples">Examples</a></ul><li><a href="#terraform-destroy">terraform destroy</a><li><a href="#terraform-taint">terraform taint</a><li><a href="#terraform-untaint">terraform untaint</a><li><a href="#terraform-refresh">terraform refresh</a><li><a href="#terraform-workspace">terraform workspace</a><li><a href="#terraform-state">terraform state</a><ul><li><a href="#examples-1">Examples</a></ul><li><a href="#terraform-output">terraform output</a><li><a href="#terraform-graph">terraform graph</a><li><a href="#terraform-import">terraform import</a><li><a href="#terraform-login-hostname">terraform login [hostname]</a><li><a href="#terraform-logout-hostname">terraform logout [hostname]</a><li><a href="#hcl-comment-styles">HCL Comment Styles</a><li><a href="#terraform-providers-plugins">Terraform Providers (Plugins)</a><li><a href="#provider-configuration">Provider Configuration</a><li><a href="#terraform-resources">Terraform Resources</a><li><a href="#terraform-variables">Terraform Variables</a><ul><li><a href="#declaring-variables">Declaring Variables</a><li><a href="#assigning-values-to-variables">Assigning values to variables</a><li><a href="#string-interpolation">String Interpolation</a></ul><li><a href="#variable-types">Variable Types</a><ul><li><a href="#type-number">type number</a><li><a href="#type-string">type string</a><li><a href="#type-bool">type bool</a><li><a href="#type-list-of-strings">type list (of strings)</a><li><a href="#type-map">type map</a><li><a href="#type-tuple">type tuple</a><li><a href="#type-object">type object</a></ul><li><a href="#data-sources">Data Sources</a><ul><li><a href="#use-data-sources">Use Data Sources</a></ul><li><a href="#output-values">Output Values</a><ul><li><a href="#declare-an-output-value">Declare an Output Value</a></ul><li><a href="#loops">Loops</a><ul><li><a href="#count">count</a><li><a href="#for_each">for_each</a><li><a href="#for-expressions">For Expressions</a><li><a href="#splat-expressions">Splat Expressions</a><li><a href="#dynamic-blocks">Dynamic Blocks</a></ul><li><a href="#conditional-expressions">Conditional Expressions</a><li><a href="#terraform-locals">Terraform Locals</a><li><a href="#terraform-provisioners">Terraform provisioners</a><li><a href="#built-in-functions">Built-in Functions</a><li><a href="#backends-and-remote-state">Backends and Remote State</a><ul><li><a href="#backends">Backends</a><li><a href="#configure-terraform-to-use-the-remote-state-from-within-the-s3-bucket">Configure Terraform to use the remote state from within the S3 bucket</a></ul><li><a href="#terraform-modules">Terraform Modules</a><li><a href="#troubleshooting-and-logging">Troubleshooting and Logging</a></ul></ul><h2 id="terraform-architecture"> <a href="#terraform-architecture" class="anchor-heading" aria-labelledby="terraform-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform Architecture</h2><p><img width="503" alt="Screen_ShotAM" src="https://user-images.githubusercontent.com/26981510/221354407-28d185ab-b559-4d3b-acfd-9ab441b1cd24.png" /></p><h2 id="installation"> <a href="#installation" class="anchor-heading" aria-labelledby="installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installation</h2><h3 id="windows"> <a href="#windows" class="anchor-heading" aria-labelledby="windows"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Windows</h3><h1 id="download-the-windows-binary-for-32-or-64-bit-cpus-from-httpswwwterraformiodownloads"> <a href="#download-the-windows-binary-for-32-or-64-bit-cpus-from-httpswwwterraformiodownloads" class="anchor-heading" aria-labelledby="download-the-windows-binary-for-32-or-64-bit-cpus-from-httpswwwterraformiodownloads"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Download the Windows binary for 32 or 64-bit CPUs from <a href="https://www.terraform.io/downloads">https://www.terraform.io/downloads</a>.</h1><h1 id="unzip-the-package"> <a href="#unzip-the-package" class="anchor-heading" aria-labelledby="unzip-the-package"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unzip the package.</h1><h1 id="move-the-terraform-binary-to-the-windows-path"> <a href="#move-the-terraform-binary-to-the-windows-path" class="anchor-heading" aria-labelledby="move-the-terraform-binary-to-the-windows-path"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Move the Terraform binary to the Windows PATH.</h1><h3 id="linux-ubuntu-package-manager"> <a href="#linux-ubuntu-package-manager" class="anchor-heading" aria-labelledby="linux-ubuntu-package-manager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Linux (Ubuntu) Package Manager</h3><h1 id="run-the-following-commands-at-the-terminal"> <a href="#run-the-following-commands-at-the-terminal" class="anchor-heading" aria-labelledby="run-the-following-commands-at-the-terminal"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Run the following commands at the terminal:</h1><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
sudo apt-get update &amp;&amp; sudo apt-get install terraform
```
</code></pre></div></div><h1 id="install-terraform-using-the-package-manager"> <a href="#install-terraform-using-the-package-manager" class="anchor-heading" aria-labelledby="install-terraform-using-the-package-manager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Install Terraform using the package manager:</h1><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
sudo apt update &amp;&amp; sudo apt install terraform -y
```
</code></pre></div></div><h3 id="macos-package-manager"> <a href="#macos-package-manager" class="anchor-heading" aria-labelledby="macos-package-manager"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> macOS Package Manager</h3><h1 id="run-the-following-commands-at-the-terminal-1"> <a href="#run-the-following-commands-at-the-terminal-1" class="anchor-heading" aria-labelledby="run-the-following-commands-at-the-terminal-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Run the following commands at the terminal:</h1><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```
brew tap hashicorp/tap
brew install hashicorp/tap/terraform
```
</code></pre></div></div><h2 id="terraform-cli"> <a href="#terraform-cli" class="anchor-heading" aria-labelledby="terraform-cli"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform CLI</h2><p>The Terraform CLI provides a variety of commands to interact with and manage Terraform configurations. Here are some commonly used commands:</p><h3 id="terraform-version"> <a href="#terraform-version" class="anchor-heading" aria-labelledby="terraform-version"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform version</h3><p>Displays the version of Terraform and all installed plugins.</p><h3 id="terraform--install-autocomplete"> <a href="#terraform--install-autocomplete" class="anchor-heading" aria-labelledby="terraform--install-autocomplete"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform -install-autocomplete</h3><p>Sets up tab auto-completion, requires logging back in.</p><h3 id="terraform-fmt"> <a href="#terraform-fmt" class="anchor-heading" aria-labelledby="terraform-fmt"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform fmt</h3><p>Rewrites all Terraform configuration files to a canonical format. Both configuration files (.tf) and variable files (.tfvars) are updated.</p><h4 id="options"> <a href="#options" class="anchor-heading" aria-labelledby="options"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Options</h4><ul><li><code class="language-plaintext highlighter-rouge">-check</code> : Check if the input is formatted. It does not overwrite the file.<li><code class="language-plaintext highlighter-rouge">-recursive</code> : Also process files in subdirectories. By default, only the given directory (or current directory) is processed.</ul><h3 id="terraform-validate"> <a href="#terraform-validate" class="anchor-heading" aria-labelledby="terraform-validate"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform validate</h3><p>Validates the configuration files for errors. It refers only to the configuration and not accessing any remote services such as remote state, or provider APIs.</p><h3 id="terraform-providers"> <a href="#terraform-providers" class="anchor-heading" aria-labelledby="terraform-providers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform providers</h3><p>Prints out a tree of modules in the referenced configuration annotated with their provider requirements.</p><h3 id="terraform-init"> <a href="#terraform-init" class="anchor-heading" aria-labelledby="terraform-init"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform init</h3><p>Initializes a new or existing Terraform working directory by creating initial files, loading any remote state, downloading modules, etc.</p><p>This is the first command that should be run for any new or existing Terraform configuration per machine. This sets up all the local data necessary to run Terraform that is typically not committed to version control.</p><p>This command is always safe to run multiple times.</p><div class="table-wrapper"><table><thead><tr><th>Option<th>Description<tbody><tr><td><code class="language-plaintext highlighter-rouge">-backend=false</code><td>Disable backend or Terraform Cloud initialization for this configuration and use what was previously initialized instead.<tr><td><code class="language-plaintext highlighter-rouge">-reconfigure</code><td>Reconfigure a backend, ignoring any saved configuration.<tr><td><code class="language-plaintext highlighter-rouge">-migrate-state</code><td>Reconfigure a backend and attempt to migrate any existing state.<tr><td><code class="language-plaintext highlighter-rouge">-upgrade</code><td>Install the latest module and provider versions allowed within configured constraints, overriding the default behavior of selecting exactly the version recorded in the dependency lockfile.</table></div><h3 id="terraform-plan"> <a href="#terraform-plan" class="anchor-heading" aria-labelledby="terraform-plan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform plan</h3><p>Generates an execution plan, showing what actions will Terraform take to apply the current configuration. This command will not actually perform the planned actions.</p><div class="table-wrapper"><table><thead><tr><th>Option<th>Description<tbody><tr><td><code class="language-plaintext highlighter-rouge">-out=path</code><td>Write a plan file to the given path. This can be used as input to the “apply” command.<tr><td><code class="language-plaintext highlighter-rouge">-input=true</code><td>Ask for input for variables if not directly set.<tr><td><code class="language-plaintext highlighter-rouge">-var 'foo=bar'</code><td>Set a value for one of the input variables in the root module of the configuration. Use this option more than once to set more than one variable.<tr><td><code class="language-plaintext highlighter-rouge">-var-file=filename</code><td>Load variable values from the given file, in addition to the default files terraform.tfvars and *.auto.tfvars. Use this option more than once to include more than one variable file.<tr><td><code class="language-plaintext highlighter-rouge">-destroy</code><td>Select the “destroy” planning mode, which creates a plan to destroy all objects currently managed by this Terraform configuration instead of the usual behavior.<tr><td><code class="language-plaintext highlighter-rouge">-refresh-only</code><td>Select the “refresh only” planning mode, which checks whether remote objects still match the outcome of the most recent Terraform apply but does not propose any actions to undo any changes made outside of Terraform.<tr><td><code class="language-plaintext highlighter-rouge">-target=resource</code><td>Limit the planning operation to only the given module, resource, or resource instance and all of its dependencies. You can use this option multiple times to include more than one object. This is for exceptional use only.</table></div><h3 id="terraform-apply"> <a href="#terraform-apply" class="anchor-heading" aria-labelledby="terraform-apply"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform apply</h3><p>Creates or updates infrastructure according to Terraform configuration files in the current directory.</p><div class="table-wrapper"><table><thead><tr><th>Option<th>Description<tbody><tr><td>-auto-approve<td>Skip interactive approval of plan before applying.<tr><td>-replace<td>Force replacement of a particular resource instance using its resource address.<tr><td>-var ‘foo=bar’<td>Set a value for one of the input variables in the root module of the configuration. Use this option more than once to set more than one variable.<tr><td>-var-file=filename<td>Load variable values from the given file, in addition to the default files terraform.tfvars and *.auto.tfvars. Use this option more than once to include more than one variable file.<tr><td>-parallelism=n<td>Limit the number of concurrent operations. Defaults to 10.</table></div><h4 id="examples"> <a href="#examples" class="anchor-heading" aria-labelledby="examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Examples</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">terraform</span> <span class="nx">apply</span> <span class="err">-</span><span class="nx">auto</span><span class="err">-</span><span class="nx">approve</span> <span class="err">-</span><span class="nx">var</span><span class="err">-</span><span class="nx">file</span><span class="err">=</span><span class="nx">ec2</span><span class="err">.</span><span class="nx">tfvars</span>
<span class="nx">terraform</span> <span class="nx">apply</span> <span class="err">-</span><span class="nx">replace</span><span class="err">=</span><span class="s2">"aws_instance.web"</span>
</code></pre></div></div><h3 id="terraform-destroy"> <a href="#terraform-destroy" class="anchor-heading" aria-labelledby="terraform-destroy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform destroy</h3><p>Destroys <code class="language-plaintext highlighter-rouge">Terraform-managed</code> infrastructure and is an alias for <code class="language-plaintext highlighter-rouge">terraform apply -destroy</code>.</p><div class="table-wrapper"><table><thead><tr><th>Option<th>Description<tbody><tr><td><code class="language-plaintext highlighter-rouge">-auto-approve</code><td>Skip interactive approval before destroying.<tr><td><code class="language-plaintext highlighter-rouge">-target</code><td>Limit the destroying operation to only the given resource and all of its dependencies. You can use this option multiple times to include more than one object.</table></div><p>Example: <code class="language-plaintext highlighter-rouge">terraform destroy -target aws_vpc.my_vpc -auto-approve</code></p><h3 id="terraform-taint"> <a href="#terraform-taint" class="anchor-heading" aria-labelledby="terraform-taint"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform taint</h3><p>Describes a resource instance that may not be fully functional, either because its creation partially failed or because you’ve manually marked it as such using this command. Subsequent Terraform plans will include actions to destroy the remote object and create a new object to replace it.</p><h3 id="terraform-untaint"> <a href="#terraform-untaint" class="anchor-heading" aria-labelledby="terraform-untaint"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform untaint</h3><p>Removes that state from a resource instance, causing Terraform to see it as fully-functional and not in need of replacement.</p><h3 id="terraform-refresh"> <a href="#terraform-refresh" class="anchor-heading" aria-labelledby="terraform-refresh"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform refresh</h3><p>Updates the state file of your infrastructure with metadata that matches the physical resources they are tracking. This will not modify your infrastructure, but it can modify your state file to update metadata.</p><h3 id="terraform-workspace"> <a href="#terraform-workspace" class="anchor-heading" aria-labelledby="terraform-workspace"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform workspace</h3><div class="table-wrapper"><table><thead><tr><th>Option<th>Description<tbody><tr><td>delete<td>Delete a workspace.<tr><td>list<td>List workspaces.<tr><td>new<td>Create a new workspace.<tr><td>select<td>Select a workspace.<tr><td>show<td>Show the name of the current workspace.</table></div><h3 id="terraform-state"> <a href="#terraform-state" class="anchor-heading" aria-labelledby="terraform-state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform state</h3><p>This does advanced state management. The state is stored by default in a local file named “terraform.tfstate”, but it can also be stored remotely, which works better in a team environment.</p><div class="table-wrapper"><table><thead><tr><th>Option<th>Description<tbody><tr><td>list<td>List resources in the state.<tr><td>show<td>Show a resource in the state.<tr><td>mv<td>Move an item in the state.<tr><td>rm<td>Remove instances from the state.<tr><td>pull<td>Pull current state and output to stdout.</table></div><h4 id="examples-1"> <a href="#examples-1" class="anchor-heading" aria-labelledby="examples-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Examples</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">terraform</span> <span class="nx">state</span> <span class="nx">show</span> <span class="nx">aws_instance</span><span class="err">.</span><span class="nx">web</span> 
<span class="nx">terraform</span> <span class="nx">state</span> <span class="nx">pull</span> <span class="err">&gt;</span> <span class="nx">my_terraform</span><span class="err">.</span><span class="nx">tfstate</span>
<span class="nx">terraform</span> <span class="nx">state</span> <span class="nx">mv</span> <span class="nx">aws_iam_role</span><span class="err">.</span><span class="nx">my_instance_role</span> 
<span class="nx">terraform</span> <span class="nx">state</span> <span class="nx">list</span>
<span class="nx">terraform</span> <span class="nx">state</span> <span class="nx">rm</span> <span class="nx">aws_instance</span><span class="err">.</span><span class="nx">web</span>
</code></pre></div></div><h3 id="terraform-output"> <a href="#terraform-output" class="anchor-heading" aria-labelledby="terraform-output"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform output</h3><p>Reads an output variable from a Terraform state file and prints the value. With no additional arguments, output will display all the outputs for the root module.</p><p>Examples:</p><ul><li><code class="language-plaintext highlighter-rouge">terraform output [-json]</code>: Lists all outputs in the state file.<li><code class="language-plaintext highlighter-rouge">terraform output instance_public_ip</code>: Lists a specific output value.</ul><h3 id="terraform-graph"> <a href="#terraform-graph" class="anchor-heading" aria-labelledby="terraform-graph"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform graph</h3><p>Produces a representation of the dependency graph between different objects in the current configuration and state. The graph is presented in the DOT language. The typical program that can read this format is GraphViz, but many web services are also available to read this format.</p><p>Linux Example:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span><span class="w"> </span><span class="nx">apt</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">graphviz</span><span class="w">
</span><span class="n">terraform</span><span class="w"> </span><span class="nx">graph</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">dot</span><span class="w"> </span><span class="nt">-Tpng</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="nx">graph.png</span><span class="w">
</span></code></pre></div></div><h3 id="terraform-import"> <a href="#terraform-import" class="anchor-heading" aria-labelledby="terraform-import"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform import</h3><p>Import existing infrastructure into your Terraform state. This will find and import the specified resource into your Terraform state, allowing existing infrastructure to come under Terraform management without having to be initially created by Terraform.</p><p>Example: <code class="language-plaintext highlighter-rouge">terraform import aws_instance.new_server i-123abc</code></p><p>Imports EC2 instance with id i-abc123 into the Terraform resource named “new_server” of type “aws_instance”.</p><h3 id="terraform-login-hostname"> <a href="#terraform-login-hostname" class="anchor-heading" aria-labelledby="terraform-login-hostname"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform login [hostname]</h3><p>Retrieves an authentication token for the given hostname, if it supports automatic login, and saves it in a credentials file in your home directory. If no hostname is provided, the default hostname is app.terraform.io, to log in to Terraform Cloud.</p><h3 id="terraform-logout-hostname"> <a href="#terraform-logout-hostname" class="anchor-heading" aria-labelledby="terraform-logout-hostname"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> terraform logout [hostname]</h3><p>Removes locally-stored credentials for the specified hostname. If no hostname is provided, the default hostname is app.terraform.io.</p><h3 id="hcl-comment-styles"> <a href="#hcl-comment-styles" class="anchor-heading" aria-labelledby="hcl-comment-styles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HCL Comment Styles</h3><ul><li><code class="language-plaintext highlighter-rouge">#</code>: single-line comment.<li><code class="language-plaintext highlighter-rouge">//</code>: single-line comment (alternative to <code class="language-plaintext highlighter-rouge">#</code>).<li><code class="language-plaintext highlighter-rouge">/* ... */</code>: multi-line comment (block comment).</ul><h3 id="terraform-providers-plugins"> <a href="#terraform-providers-plugins" class="anchor-heading" aria-labelledby="terraform-providers-plugins"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform Providers (Plugins)</h3><p>A provider is a Terraform plugin that allows users to manage an external API.</p><p>A provider usually provides resources to manage a cloud or infrastructure platform, such as AWS or Azure, or technology (for example Kubernetes).</p><p>There are providers for Infrastructure as a Service (IaaS), Platform as a Service (PaaS), and Software as a Service (SaaS).</p><h3 id="provider-configuration"> <a href="#provider-configuration" class="anchor-heading" aria-labelledby="provider-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Provider Configuration</h3><div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>  <span class="c1"># global and unique source address</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.0"</span>         <span class="c1"># version constraint</span>
    <span class="p">}</span> 
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Configure the AWS Provider</span>
<span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"eu-west-1"</span> <span class="c1"># provider configuration options</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="terraform-resources"> <a href="#terraform-resources" class="anchor-heading" aria-labelledby="terraform-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform Resources</h3><p>Resources are the most important element in the Terraform language. It describes one or more infrastructure objects to manage.</p><p>Together the resource type and local name serve as an identifier for a given resource and must be unique within a module. Example: aws_vpc.main</p><p>Creating resources:</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">resource</span> <span class="s2">"&lt;provider&gt;_&lt;resource_type&gt;"</span> <span class="s2">"local_name"</span><span class="p">{</span>
    <span class="nx">argument1</span> <span class="p">=</span> <span class="nx">value</span>
    <span class="nx">argument2</span>  <span class="p">=</span> <span class="nx">value</span>
    <span class="err">…</span>
<span class="p">}</span>

<span class="c1"># Example:</span>
<span class="nx">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"main"</span> <span class="p">{</span>
    <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"10.0.0.0/16"</span>
    <span class="nx">enable_dns_support</span> <span class="p">=</span> <span class="kc">true</span>

    <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
        <span class="s2">"Name"</span> <span class="p">=</span> <span class="s2">"Main VPC"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="terraform-variables"> <a href="#terraform-variables" class="anchor-heading" aria-labelledby="terraform-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform Variables</h3><p>Input variables allow you customize aspects of Terraform without using hard-coded values in the source.</p><h4 id="declaring-variables"> <a href="#declaring-variables" class="anchor-heading" aria-labelledby="declaring-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Declaring Variables</h4><p>Variable declarations can appear anywhere in your configuration files. However, it’s recommended to put them into a separate file called <code class="language-plaintext highlighter-rouge">variables.tf</code>.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># variable declaration</span>
<span class="nx">variable</span> <span class="s2">"vpc_cidr_block"</span> <span class="p">{</span>
   <span class="nx">description</span> <span class="p">=</span> <span class="s2">"CIDR block for VPC"</span><span class="err">.</span>
   <span class="nx">default</span> <span class="p">=</span> <span class="s2">"192.168.0.0/16"</span>
   <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="assigning-values-to-variables"> <a href="#assigning-values-to-variables" class="anchor-heading" aria-labelledby="assigning-values-to-variables"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assigning values to variables</h4><h1 id="using-the-default-argument-in-the-variable-declaration-block"> <a href="#using-the-default-argument-in-the-variable-declaration-block" class="anchor-heading" aria-labelledby="using-the-default-argument-in-the-variable-declaration-block"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using the default argument in the variable declaration block.</h1><h1 id="assign-a-value-to-the-variable-in-the-variable-definition-file-which-by-default-is-terraformtfvars-example-vpc_cidr_block--172160016"> <a href="#assign-a-value-to-the-variable-in-the-variable-definition-file-which-by-default-is-terraformtfvars-example-vpc_cidr_block--172160016" class="anchor-heading" aria-labelledby="assign-a-value-to-the-variable-in-the-variable-definition-file-which-by-default-is-terraformtfvars-example-vpc_cidr_block--172160016"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assign a value to the variable in the variable definition file which by default is terraform.tfvars. Example: <strong>vpc_cidr_block = “172.16.0.0/16”</strong></h1><h1 id="using--var-command-line-option-example-terraform-apply--varvpc_cidr_block10010024"> <a href="#using--var-command-line-option-example-terraform-apply--varvpc_cidr_block10010024" class="anchor-heading" aria-labelledby="using--var-command-line-option-example-terraform-apply--varvpc_cidr_block10010024"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using <code class="language-plaintext highlighter-rouge">-var</code> command-line option. Example: <strong>terraform apply -var=”vpc_cidr_block=10.0.10.0/24”</strong></h1><h1 id="using--var-file-command-line-option-example-terraform-apply--auto-approve--var-fileweb-prodtfvars"> <a href="#using--var-file-command-line-option-example-terraform-apply--auto-approve--var-fileweb-prodtfvars" class="anchor-heading" aria-labelledby="using--var-file-command-line-option-example-terraform-apply--auto-approve--var-fileweb-prodtfvars"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using <code class="language-plaintext highlighter-rouge">-var-file</code> command-line option. Example: <strong>terraform apply -auto-approve -var-file=web-prod.tfvars</strong></h1><h1 id="exporting-the-variable-at-the-terminal-example-export-tf_var_vpc_cidr_block192168100024"> <a href="#exporting-the-variable-at-the-terminal-example-export-tf_var_vpc_cidr_block192168100024" class="anchor-heading" aria-labelledby="exporting-the-variable-at-the-terminal-example-export-tf_var_vpc_cidr_block192168100024"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exporting the variable at the terminal. Example: <strong>export TF_VAR_vpc_cidr_block=”192.168.100.0/24”</strong></h1><p>Variable definition precedence <code class="language-plaintext highlighter-rouge">(from highest to lowest)</code>:</p><h1 id="variables-specified-at-the-terminal-using--var-and--var-file-options"> <a href="#variables-specified-at-the-terminal-using--var-and--var-file-options" class="anchor-heading" aria-labelledby="variables-specified-at-the-terminal-using--var-and--var-file-options"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variables specified at the terminal using <strong>-var</strong> and <strong>-var-file</strong> options.</h1><h1 id="variables-defined-in-terraformtfvars"> <a href="#variables-defined-in-terraformtfvars" class="anchor-heading" aria-labelledby="variables-defined-in-terraformtfvars"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variables defined in <strong>terraform.tfvars</strong>.</h1><h1 id="variables-defined-as-environment-variables-using-tf_var-prefix"> <a href="#variables-defined-as-environment-variables-using-tf_var-prefix" class="anchor-heading" aria-labelledby="variables-defined-as-environment-variables-using-tf_var-prefix"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variables defined as environment variables using TF_VAR prefix.</h1><h4 id="string-interpolation"> <a href="#string-interpolation" class="anchor-heading" aria-labelledby="string-interpolation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> String Interpolation</h4><p>You can interpolate other values in strings by these values in <code class="language-plaintext highlighter-rouge">${}</code>, such as <code class="language-plaintext highlighter-rouge">${var.foo}</code>.</p><p>The interpolation syntax is powerful and allows you to reference <code class="language-plaintext highlighter-rouge">variables</code>, <code class="language-plaintext highlighter-rouge">attributes of resources</code>, <code class="language-plaintext highlighter-rouge">call functions</code>, etc.</p><p>You can escape interpolation with double dollar signs: <code class="language-plaintext highlighter-rouge">$${foo}</code> will be rendered as a literal <code class="language-plaintext highlighter-rouge">${foo}</code>.</p><h3 id="variable-types"> <a href="#variable-types" class="anchor-heading" aria-labelledby="variable-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variable Types</h3><ul><li><strong>Simple types</strong> a. number b. string c. bool d. null<li><strong>Complex types</strong> a. Collection types i. list ii. map iii. set b. Structural types i. tuple object</ul><h4 id="type-number"> <a href="#type-number" class="anchor-heading" aria-labelledby="type-number"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> type number</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"web_port"</span> <span class="p">{</span>
    <span class="nx">description</span> <span class="p">=</span> <span class="s2">"Web Port"</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="mi">80</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="nx">number</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="type-string"> <a href="#type-string" class="anchor-heading" aria-labelledby="type-string"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> type string</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"aws_region"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"AWS Region"</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">string</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="s2">"eu-west-1"</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="type-bool"> <a href="#type-bool" class="anchor-heading" aria-labelledby="type-bool"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> type bool</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"enable_dns"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"DNS Support for the VPC"</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">bool</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="type-list-of-strings"> <a href="#type-list-of-strings" class="anchor-heading" aria-labelledby="type-list-of-strings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> type list (of strings)</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">type</span> <span class="nx">list</span> <span class="err">(</span><span class="nx">of</span> <span class="nx">strings</span><span class="err">)</span>
<span class="nx">variable</span> <span class="s2">"azs"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"AZs in the Region"</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="err">(</span><span class="nx">string</span><span class="err">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span> 
      <span class="s2">"eu-west-1a"</span><span class="p">,</span> 
      <span class="s2">"eu-west-1b"</span><span class="p">,</span> 
      <span class="s2">"eu-west-1c"</span> 
      <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="type-map"> <a href="#type-map" class="anchor-heading" aria-labelledby="type-map"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> type map</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"amis"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">map</span><span class="err">(</span><span class="nx">string</span><span class="err">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"eu-central-1"</span> <span class="p">=</span> <span class="s2">"ami-0dcc0ebde7b2e00db"</span><span class="err">,</span>
    <span class="s2">"us-west-1"</span> <span class="p">=</span> <span class="s2">"ami-04a50faf2a2ec1901"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="type-tuple"> <a href="#type-tuple" class="anchor-heading" aria-labelledby="type-tuple"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> type tuple</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"my_instance"</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="nx">tuple</span><span class="err">(</span><span class="p">[</span><span class="nx">string</span><span class="p">,</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">bool</span><span class="p">]</span><span class="err">)</span>  
    <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"t2.micro"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">true</span> <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div><h4 id="type-object"> <a href="#type-object" class="anchor-heading" aria-labelledby="type-object"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> type object</h4><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"egress_dsg"</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="nx">object</span><span class="err">(</span><span class="p">{</span>
        <span class="nx">from_port</span> <span class="p">=</span> <span class="nx">number</span>
        <span class="nx">to_port</span> <span class="p">=</span> <span class="nx">number</span>
        <span class="nx">protocol</span> <span class="p">=</span> <span class="nx">string</span>
        <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="nx">list</span><span class="err">(</span><span class="nx">string</span><span class="err">)</span>
    <span class="p">}</span><span class="err">)</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
     <span class="nx">from_port</span> <span class="p">=</span> <span class="mi">0</span><span class="err">,</span>
     <span class="nx">to_port</span> <span class="p">=</span> <span class="mi">65365</span><span class="err">,</span>
     <span class="nx">protocol</span> <span class="p">=</span> <span class="s2">"tcp"</span><span class="err">,</span>
     <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"100.0.0.0/16"</span><span class="p">,</span> <span class="s2">"200.0.0.0/16"</span><span class="p">,</span> <span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="data-sources"> <a href="#data-sources" class="anchor-heading" aria-labelledby="data-sources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Data Sources</h3><p>Data sources in Terraform are used to get information about resources external to Terraform. For example, the public IP address of an EC2 instance. Data sources are provided by providers.</p><h4 id="use-data-sources"> <a href="#use-data-sources" class="anchor-heading" aria-labelledby="use-data-sources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use Data Sources</h4><p>A data block requests that Terraform read from a given data source (“aws_ami”) and export the result under the given local name (“ubuntu”).</p><p>The data source and name together serve as an identifier for a given resource and therefore must be unique within a module.</p><p>Within the block body (between { and }) are query constraints defined by the data source.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">data</span> <span class="s2">"aws_ami"</span> <span class="s2">"ubuntu"</span> <span class="p">{</span>
 <span class="nx">most_recent</span> <span class="p">=</span> <span class="kc">true</span>

 <span class="nx">owners</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"self"</span><span class="p">]</span>
 <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
   <span class="nx">Name</span>   <span class="p">=</span> <span class="s2">"app-server"</span>
   <span class="nx">Tested</span> <span class="p">=</span> <span class="s2">"true"</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="output-values"> <a href="#output-values" class="anchor-heading" aria-labelledby="output-values"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Output Values</h3><p>Output values print out information about your infrastructure at the terminal, and can expose information for other Terraform configurations (e.g. modules) to use.</p><h4 id="declare-an-output-value"> <a href="#declare-an-output-value" class="anchor-heading" aria-labelledby="declare-an-output-value"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Declare an Output Value</h4><p>Each output value exported by a module must be declared using an output block. The label immediately after the output keyword is the name.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">output</span> <span class="s2">"instance_ip_addr"</span> <span class="p">{</span>
 <span class="nx">value</span> <span class="p">=</span> <span class="nx">aws_instance</span><span class="err">.</span><span class="nx">server</span><span class="err">.</span><span class="nx">private_ip</span> 
<span class="p">}</span>
</code></pre></div></div><h3 id="loops"> <a href="#loops" class="anchor-heading" aria-labelledby="loops"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Loops</h3><p>Terraform offers the following looping constructs, each intended to be used in a slightly different scenario:</p><ul><li><code class="language-plaintext highlighter-rouge">count</code> meta-argument: loop over resources.<li><code class="language-plaintext highlighter-rouge">for_each</code> meta-argument: loop over resources and inline blocks within a resource.<li><code class="language-plaintext highlighter-rouge">for</code> expressions: loop over lists and maps.</ul><h4 id="count"> <a href="#count" class="anchor-heading" aria-labelledby="count"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> count</h4><p>The <strong>count</strong> meta-argument is defined by the Terraform language and can be used to manage similar resources.</p><p><code class="language-plaintext highlighter-rouge">count</code> is a looping technique and can be used with modules and with every resource type.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># creating 3 EC2 instances using count</span>
<span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"web"</span> <span class="p">{</span>
  <span class="nx">ami</span> <span class="p">=</span> <span class="s2">"ami-06ec8443c2a35b0ba"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="mi">3</span>  
<span class="p">}</span>
</code></pre></div></div><p>In blocks where count is set, an additional count object is available.</p><p><code class="language-plaintext highlighter-rouge">count.index</code> represents the distinct index number (starting with 0) corresponding to the current object.</p><h4 id="for_each"> <a href="#for_each" class="anchor-heading" aria-labelledby="for_each"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> for_each</h4><p><code class="language-plaintext highlighter-rouge">for_each</code> is another meta-argument used to duplicate resources that are similar but need to be configured differently.</p><p><code class="language-plaintext highlighter-rouge">for_each</code> was introduced more recently to overcome the downsides of count.</p><p>If your resources are almost identical, count is appropriate. If some of their arguments need distinct values that can’t be directly derived from an integer, it’s safer to use for_each.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># declaring a variable</span>
<span class="nx">variable</span> <span class="s2">"users"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="err">(</span><span class="nx">string</span><span class="err">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"demo"</span><span class="p">,</span> <span class="s2">"test"</span><span class="p">,</span> <span class="s2">"john"</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># creating IAM users</span>
<span class="nx">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"user"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">toset</span><span class="err">(</span><span class="nx">var</span><span class="err">.</span><span class="nx">users</span><span class="err">)</span> <span class="c1"># converts a list to a set</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="nx">each</span><span class="err">.</span><span class="nx">key</span>
<span class="p">}</span>
</code></pre></div></div><p>Second example</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"example_map"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">map</span><span class="err">(</span><span class="nx">string</span><span class="err">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"key1"</span> <span class="p">=</span> <span class="s2">"value1"</span>
    <span class="s2">"key2"</span> <span class="p">=</span> <span class="s2">"value2"</span>
    <span class="s2">"key3"</span> <span class="p">=</span> <span class="s2">"value3"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">#use the var </span>
<span class="nx">resource</span> <span class="s2">"aws_s3_bucket"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">example_map</span>
  
  <span class="nx">bucket</span> <span class="p">=</span> <span class="nx">each</span><span class="err">.</span><span class="nx">key</span>
<span class="p">}</span>

</code></pre></div></div><h4 id="for-expressions"> <a href="#for-expressions" class="anchor-heading" aria-labelledby="for-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> For Expressions</h4><p>A <code class="language-plaintext highlighter-rouge">for</code> expression creates a complex type value by transforming another complex type value.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">variable</span> <span class="s2">"names"</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"daniel"</span><span class="p">,</span> <span class="s2">"ada'"</span><span class="p">,</span> <span class="s2">"john wick"</span><span class="p">]</span>
<span class="p">}</span>
<span class="nx">output</span> <span class="s2">"short_upper_names"</span> <span class="p">{</span>
  <span class="c1"># filter the resulting list by specifying a condition:</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="p">[</span><span class="nx">for</span> <span class="nx">name</span> <span class="nx">in</span> <span class="nx">var</span><span class="err">.</span><span class="nx">names</span> <span class="err">:</span> <span class="nx">upper</span><span class="err">(</span><span class="nx">name</span><span class="err">)</span> <span class="nx">if</span> <span class="nx">length</span><span class="err">(</span><span class="nx">name</span><span class="err">)</span> <span class="err">&gt;</span> <span class="mi">7</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div><p>If you run <strong>terraform apply -auto-approve</strong> you’ll get:</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Outputs</span><span class="err">:</span>

<span class="nx">short_upper_names</span> <span class="err">=</span> <span class="p">[</span>
  <span class="s2">"JOHN WICK"</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div></div><h4 id="splat-expressions"> <a href="#splat-expressions" class="anchor-heading" aria-labelledby="splat-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Splat Expressions</h4><p>A <code class="language-plaintext highlighter-rouge">splat</code> expression provides a more concise way to express a common operation that could otherwise be performed with a for expression.</p><h4 id="dynamic-blocks"> <a href="#dynamic-blocks" class="anchor-heading" aria-labelledby="dynamic-blocks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dynamic Blocks</h4><p>Dynamic blocks act much like a for expression, but produce nested blocks instead of a complex typed value. They iterate over a given complex value, and generate a nested block for each element of that complex value.</p><p>They are supported inside resource, data, provider, and provisioner blocks.</p><p>A dynamic block produces nested blocks instead of a complex typed value.</p><div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Declaring a variable of type list</span>
<span class="k">variable</span> <span class="s2">"ingress_ports"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"List Of Ingress Ports"</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">number</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">143</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_default_security_group"</span> <span class="s2">"default_sec_group"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>

 <span class="c1"># Creating the ingress rules using dynamic blocks</span>
 <span class="nx">dynamic</span> <span class="s2">"ingress"</span><span class="p">{</span>  <span class="c1"># it produces ingress nested blocks</span>
    <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">ingress_ports</span> <span class="c1"># iterating over the list variable</span>
    <span class="nx">iterator</span> <span class="p">=</span> <span class="nx">iport</span>
    <span class="nx">content</span> <span class="p">{</span>
        <span class="nx">from_port</span> <span class="p">=</span> <span class="nx">iport</span><span class="p">.</span><span class="nx">value</span>
        <span class="nx">to_port</span> <span class="p">=</span> <span class="nx">iport</span><span class="p">.</span><span class="nx">value</span>
        <span class="nx">protocol</span> <span class="p">=</span> <span class="s2">"tcp"</span>
        <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
     <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>A second example</p><div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">variable</span> <span class="s2">"security_group_rules"</span> <span class="p">{</span>
  <span class="nx">type</span> <span class="p">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">object</span><span class="p">({</span>
    <span class="nx">type</span>        <span class="p">=</span> <span class="nx">string</span>
    <span class="nx">from_port</span>   <span class="p">=</span> <span class="nx">number</span>
    <span class="nx">to_port</span>     <span class="p">=</span> <span class="nx">number</span>
    <span class="nx">protocol</span>    <span class="p">=</span> <span class="nx">string</span>
    <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="nx">list</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span>
  <span class="p">}))</span>
  
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"ssh"</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">type</span>        <span class="p">=</span> <span class="s2">"ssh"</span>
      <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">22</span>
      <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">22</span>
      <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
      <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">"http"</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">type</span>        <span class="p">=</span> <span class="s2">"http"</span>
      <span class="nx">from_port</span>   <span class="p">=</span> <span class="mi">80</span>
      <span class="nx">to_port</span>     <span class="p">=</span> <span class="mi">80</span>
      <span class="nx">protocol</span>    <span class="p">=</span> <span class="s2">"tcp"</span>
      <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"0.0.0.0/0"</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">#use it now</span>
<span class="k">resource</span> <span class="s2">"aws_security_group"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">dynamic</span> <span class="s2">"ingress"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">security_group_rules</span>
    <span class="nx">content</span> <span class="p">{</span>
      <span class="nx">type</span>        <span class="p">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">type</span>
      <span class="nx">from_port</span>   <span class="p">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">from_port</span>
      <span class="nx">to_port</span>     <span class="p">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">to_port</span>
      <span class="nx">protocol</span>    <span class="p">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">protocol</span>
      <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="nx">ingress</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">cidr_blocks</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div><h3 id="conditional-expressions"> <a href="#conditional-expressions" class="anchor-heading" aria-labelledby="conditional-expressions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conditional Expressions</h3><p>A <code class="language-plaintext highlighter-rouge">conditional expression</code> uses the value of a boolean expression to select one of two values.</p><p>Syntax: <strong>condition ? true_val : false_val</strong></p><p>If condition is true then the result is true_val. If condition is false then the result is false_val.</p><p>The condition can be any expression that resolves to a boolean value. This will usually be an expression that uses the equality, comparison, or logical operators.</p><div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">variable</span> <span class="s2">"iscreate"</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="p">=</span> <span class="nx">bool</span>
    <span class="nx">default</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="c1"># Creating the test-server instance if `iscreate` equals true</span>
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"test-server"</span> <span class="p">{</span>
  <span class="nx">ami</span> <span class="p">=</span> <span class="s2">"ami-05cafdf7c9f772ad2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">iscreate</span> <span class="p">==</span> <span class="kc">true</span> <span class="err">?</span> <span class="mi">1</span><span class="err">:</span><span class="mi">0</span>  <span class="c1"># conditional expression</span>
<span class="p">}</span>

<span class="c1"># Creating the prod-server instance if `iscreate` equals false</span>
<span class="k">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"prod-server"</span> <span class="p">{</span>
  <span class="nx">ami</span> <span class="p">=</span> <span class="s2">"ami-05cafdf7c9f772ad2"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.large"</span>   <span class="c1"># it's not free tier eligible</span>
  <span class="nx">count</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">iscreate</span> <span class="p">==</span> <span class="kc">false</span> <span class="err">?</span> <span class="mi">1</span><span class="err">:</span><span class="mi">0</span>  <span class="c1"># conditional expression</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="terraform-locals"> <a href="#terraform-locals" class="anchor-heading" aria-labelledby="terraform-locals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform Locals</h3><p>Terraform <code class="language-plaintext highlighter-rouge">local values</code> are named values that you can refer to in your configuration.</p><p>Compared to variables, Terraform locals do not change values during or between Terraform runs and unlike input variables, locals are not submitted by users but calculated inside the configuration.</p><p>Locals are available only in the current module. They are locally scoped.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># the local values are declared in a single `locals` block</span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">owner</span> <span class="p">=</span> <span class="s2">"Saif"</span>
  <span class="nx">cidr_blocks</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"172.16.10.0/24"</span><span class="p">,</span> <span class="s2">"172.16.20.0/24"</span><span class="p">,</span> <span class="s2">"172.16.30.0/24"</span><span class="p">]</span>
  <span class="nx">common</span><span class="err">-</span><span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">Name</span> <span class="p">=</span> <span class="s2">"dev"</span>
      <span class="nx">Environment</span> <span class="p">=</span> <span class="s2">"development"</span>
      <span class="nx">Version</span> <span class="p">=</span> <span class="mf">1.10</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Create a VPC.</span>
<span class="nx">resource</span> <span class="s2">"aws_vpc"</span> <span class="s2">"dev_vpc"</span> <span class="p">{</span>
  <span class="nx">cidr_block</span> <span class="p">=</span> <span class="s2">"172.16.0.0/16"</span>
  <span class="nx">tags</span> <span class="p">=</span> <span class="nx">local</span><span class="err">.</span><span class="nx">common</span><span class="err">-</span><span class="nx">tags</span>
<span class="p">}</span> 

<span class="c1"># Create a subnet in the VPC</span>
<span class="nx">resource</span> <span class="s2">"aws_subnet"</span> <span class="s2">"dev_subnets"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span>            <span class="p">=</span> <span class="nx">aws_vpc</span><span class="err">.</span><span class="nx">dev_vpc</span><span class="err">.</span><span class="nx">id</span>
  <span class="nx">cidr_block</span>        <span class="p">=</span> <span class="nx">local</span><span class="err">.</span><span class="nx">cidr_blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="nx">availability_zone</span> <span class="p">=</span> <span class="s2">"eu-west-1a"</span>

  <span class="nx">tags</span> <span class="p">=</span> <span class="nx">local</span><span class="err">.</span><span class="nx">common</span><span class="err">-</span><span class="nx">tags</span>
<span class="p">}</span>

<span class="c1"># Create an Internet Gateway Resource</span>
<span class="nx">resource</span> <span class="s2">"aws_internet_gateway"</span> <span class="s2">"dev_igw"</span> <span class="p">{</span>
  <span class="nx">vpc_id</span> <span class="p">=</span> <span class="nx">aws_vpc</span><span class="err">.</span><span class="nx">dev_vpc</span><span class="err">.</span><span class="nx">id</span>  
  <span class="nx">tags</span> <span class="p">=</span> <span class="p">{</span>
    <span class="s2">"Name"</span> <span class="p">=</span> <span class="s2">"${local.common-tags["</span><span class="nx">Name</span><span class="s2">"]}-igw"</span>
    <span class="s2">"Version"</span> <span class="p">=</span> <span class="s2">"${local.common-tags["</span><span class="nx">Version</span><span class="s2">"]}"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p><strong>Note:</strong> Local values are created by a locals block (plural), but you reference them as attributes on an object named local (singular).</p><h3 id="terraform-provisioners"> <a href="#terraform-provisioners" class="anchor-heading" aria-labelledby="terraform-provisioners"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform provisioners</h3><p>Terraform Provisioners are used to execute scripts or commands on a resource after it has been created or destroyed. Provisioners are typically used to configure a newly created resource, such as <code class="language-plaintext highlighter-rouge">installing software</code> or executing a <code class="language-plaintext highlighter-rouge">post-creation</code> script. In Terraform, there are two types of provisioners:</p><p><code class="language-plaintext highlighter-rouge">Local-exec Provisioner</code>: This provisioner is used to execute commands on the machine running Terraform.</p><p>Example</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-0c55b159cbfafe1f0"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>

  <span class="nx">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="p">=</span> <span class="s2">"echo ${aws_instance.example.private_ip} &gt; private_ip.txt"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">Remote-exec Provisioner</code>: This provisioner is used to execute commands on the newly created resource.</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"example"</span> <span class="p">{</span>
  <span class="nx">ami</span>           <span class="p">=</span> <span class="s2">"ami-0c55b159cbfafe1f0"</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="s2">"t2.micro"</span>
  
  <span class="nx">key_name</span> <span class="p">=</span> <span class="s2">"my_key_pair"</span>

  <span class="nx">provisioner</span> <span class="s2">"remote-exec"</span> <span class="p">{</span>
    <span class="nx">inline</span> <span class="p">=</span> <span class="p">[</span>
      <span class="s2">"sudo apt-get update"</span><span class="p">,</span>
      <span class="s2">"sudo apt-get install -y nginx"</span><span class="p">,</span>
      <span class="s2">"sudo service nginx start"</span>
    <span class="p">]</span>

    <span class="nx">connection</span> <span class="p">{</span>
      <span class="nx">type</span>     <span class="p">=</span> <span class="s2">"ssh"</span>
      <span class="nx">user</span>     <span class="p">=</span> <span class="s2">"ubuntu"</span>
      <span class="nx">private_key</span> <span class="p">=</span> <span class="nx">file</span><span class="err">(</span><span class="s2">"~/.ssh/my_key_pair.pem"</span><span class="err">)</span>
      <span class="nx">host</span>     <span class="p">=</span> <span class="nx">aws_instance</span><span class="err">.</span><span class="nx">example</span><span class="err">.</span><span class="nx">public_ip</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div><h3 id="built-in-functions"> <a href="#built-in-functions" class="anchor-heading" aria-labelledby="built-in-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Built-in Functions</h3><p>Terraform includes a number of built-in functions that can be called from within expressions to transform and combine values.</p><p>Examples of functions: min, max, file, concat, element, index, lookup.</p><p>Terraform does not support user-defined functions.</p><p>There are functions for numbers, strings, collections, file system, date and time, IP Network, Type Conversions and more.</p><p>You can experiment with the behavior of Terraform’s built-in functions from the <strong>Terraform console</strong>, by running the terraform console command.</p><p>Examples:</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">&gt;</span> <span class="nx">max</span><span class="err">(</span><span class="mi">1</span><span class="err">,</span> <span class="mi">12</span><span class="err">,</span> <span class="mi">10</span><span class="err">)</span>
<span class="mi">12</span>

<span class="err">&gt;</span> <span class="nx">min</span><span class="err">(</span><span class="mi">12</span><span class="err">,</span> <span class="mi">54</span><span class="err">,</span> <span class="mi">9</span><span class="err">)</span>
<span class="mi">9</span>

<span class="err">&gt;</span> <span class="nx">format</span><span class="err">(</span><span class="s2">"There are %d lights"</span><span class="err">,</span> <span class="mi">4</span><span class="err">)</span>
<span class="nx">There</span> <span class="nx">are</span> <span class="mi">4</span> <span class="nx">lights</span>

<span class="err">&gt;</span> <span class="nx">join</span><span class="err">(</span><span class="s2">", "</span><span class="err">,</span> <span class="p">[</span><span class="s2">"foo"</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">]</span><span class="err">)</span>
<span class="nx">foo</span><span class="err">,</span> <span class="nx">bar</span>

<span class="err">&gt;</span> <span class="nx">split</span><span class="err">(</span><span class="s2">","</span><span class="err">,</span> <span class="s2">"foo,bar"</span><span class="err">)</span>
<span class="p">[</span>
 <span class="s2">"foo"</span><span class="p">,</span>
 <span class="s2">"bar"</span>
<span class="p">]</span>

<span class="err">&gt;</span> <span class="nx">replace</span><span class="err">(</span><span class="s2">"hello world"</span><span class="err">,</span> <span class="s2">"/w.*d/"</span><span class="err">,</span> <span class="s2">"everybody"</span><span class="err">)</span>
<span class="nx">hello</span> <span class="nx">everybody</span>

<span class="err">&gt;</span> <span class="nx">substr</span><span class="err">(</span><span class="s2">"hello world"</span><span class="err">,</span> <span class="mi">1</span><span class="err">,</span> <span class="mi">4</span><span class="err">)</span>
<span class="nx">ello</span>

<span class="err">&gt;</span> <span class="nx">element</span><span class="err">(</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">]</span><span class="err">,</span> <span class="mi">1</span><span class="err">)</span>
<span class="nx">b</span>

<span class="err">&gt;</span> <span class="nx">lookup</span><span class="err">(</span><span class="p">{</span><span class="nx">a</span><span class="p">=</span><span class="s2">"ay"</span><span class="err">,</span> <span class="nx">b</span><span class="p">=</span><span class="s2">"bee"</span><span class="p">}</span><span class="err">,</span> <span class="s2">"a"</span><span class="err">,</span> <span class="s2">"what?"</span><span class="err">)</span>
<span class="nx">ay</span>
<span class="err">&gt;</span> <span class="nx">lookup</span><span class="err">(</span><span class="p">{</span><span class="nx">a</span><span class="p">=</span><span class="s2">"ay"</span><span class="err">,</span> <span class="nx">b</span><span class="p">=</span><span class="s2">"bee"</span><span class="p">}</span><span class="err">,</span> <span class="s2">"c"</span><span class="err">,</span> <span class="s2">"what?"</span><span class="err">)</span>
<span class="nx">what</span><span class="err">?</span>

<span class="err">&gt;</span> <span class="nx">slice</span><span class="err">(</span><span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]</span><span class="err">,</span> <span class="mi">1</span><span class="err">,</span> <span class="mi">3</span><span class="err">)</span>
<span class="p">[</span>
 <span class="s2">"b"</span><span class="p">,</span>
 <span class="s2">"c"</span><span class="p">,</span>
<span class="p">]</span>

<span class="err">&gt;</span> <span class="nx">timestamp</span><span class="err">()</span>
<span class="s2">"2023-25-02T13:52:18Z"</span>

<span class="err">&gt;</span> <span class="nx">formatdate</span><span class="err">(</span><span class="s2">"DD MMM YYYY hh:mm ZZZ"</span><span class="err">,</span> <span class="s2">"2023-25-02T13:52:18Z"</span><span class="err">)</span>
<span class="mi">25</span> <span class="nx">Feb</span> <span class="mi">2023</span> <span class="mi">13</span><span class="err">:</span><span class="mi">52</span> <span class="nx">UTC</span>

<span class="err">&gt;</span> <span class="nx">cidrhost</span><span class="err">(</span><span class="s2">"10.1.2.240/28"</span><span class="err">,</span> <span class="mi">1</span><span class="err">)</span>
<span class="mf">10.1</span><span class="err">.</span><span class="mf">2.241</span>

<span class="err">&gt;</span> <span class="nx">cidrhost</span><span class="err">(</span><span class="s2">"10.1.2.240/28"</span><span class="err">,</span> <span class="mi">14</span><span class="err">)</span>
<span class="mf">10.1</span><span class="err">.</span><span class="mf">2.254</span>
</code></pre></div></div><h3 id="backends-and-remote-state"> <a href="#backends-and-remote-state" class="anchor-heading" aria-labelledby="backends-and-remote-state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backends and Remote State</h3><h4 id="backends"> <a href="#backends" class="anchor-heading" aria-labelledby="backends"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backends</h4><p>Each Terraform configuration has an associated backend that defines how operations are executed and where the Terraform state is stored.</p><p>The default backend is local, and it stores the state as a plain file in the current working directory.</p><p>The backend needs to be initialized by running terraform init.</p><p>If you switch the backend, Terraform provides a migration option which is terraform init -migrate-state.</p><p>Terraform supports both local and remote backends:</p><p>local (default) backend stores state in a local JSON file on disk. remote backends stores state remotely. Examples of remote backends are AzureRM, Consul, GCS, Amazon S3, and Terraform Cloud. They can support features like remote operation, state locking, encryption, and versioning. Configure Remote State on Amazon S3 On the AWS console go to Amazon S3 and create a bucket.</p><h4 id="configure-terraform-to-use-the-remote-state-from-within-the-s3-bucket"> <a href="#configure-terraform-to-use-the-remote-state-from-within-the-s3-bucket" class="anchor-heading" aria-labelledby="configure-terraform-to-use-the-remote-state-from-within-the-s3-bucket"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure Terraform to use the remote state from within the S3 bucket</h4><ul><li><p>On the AWS console go to <code class="language-plaintext highlighter-rouge">Amazon S3</code> and <code class="language-plaintext highlighter-rouge">create a bucket</code>.</p><li><h2 id="configure-terraform-to-use-the-remote-state-from-within-the-s3-bucket-1"> <a href="#configure-terraform-to-use-the-remote-state-from-within-the-s3-bucket-1" class="anchor-heading" aria-labelledby="configure-terraform-to-use-the-remote-state-from-within-the-s3-bucket-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configure Terraform to use the <strong>remote state</strong> from within the S3 bucket.</h2></ul><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">terraform</span> <span class="p">{</span>
 <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
   <span class="nx">bucket</span> <span class="p">=</span> <span class="s2">"terraform-state"</span>
   <span class="nx">key</span>    <span class="p">=</span> <span class="s2">"s3-backend.tfstate"</span>
   <span class="nx">region</span> <span class="p">=</span> <span class="s2">"eu-west-1"</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><ul><li>Run <code class="language-plaintext highlighter-rouge">terraform init</code> to initialize the backend.</ul><h3 id="terraform-modules"> <a href="#terraform-modules" class="anchor-heading" aria-labelledby="terraform-modules"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terraform Modules</h3><p>Terraform modules are a powerful way to reuse code and stick to the <strong>DRY principle</strong>, which stands for <code class="language-plaintext highlighter-rouge">Do Not Repeat Yourself</code>. Think of modules as functions in a programming language.</p><p><strong>Modules</strong> will help you organize configuration, encapsulate configuration, re-use configuration and provide consistency and ensure best-practices.</p><p>Terraform supports Local and Remote modules:</p><ul><li><p><strong>Local modules</strong> are stored locally, in a separate directory, outside of the root environment and have the source path prefixed with ./ or ../</p><li><p><strong>Remote modules</strong> are stored externally in a separate repository, and support versioning. External Terraform modules are found on the Terraform Registry.</p></ul><p>A Terraform module is a set of Terraform configuration files in a single directory.</p><p>When you run Terraform commands like <code class="language-plaintext highlighter-rouge">terraform plan</code> or <code class="language-plaintext highlighter-rouge">terraform apply</code> directly from such a directory, then that directory will be considered the root module.</p><p>The modules that are imported from other directories into the root module are called child modules.</p><p>Calling a child module from within the root module:</p><div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span> <span class="s2">"myec2"</span> <span class="p">{</span>
  <span class="c1"># path to the module's directory</span>
  <span class="c1"># the source argument is mandatory for all modules.</span>
  <span class="nx">source</span> <span class="p">=</span> <span class="s2">"../modules/ec2"</span>

  <span class="c1"># module inputs</span>
  <span class="nx">ami_id</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">ami_id</span>
  <span class="nx">instance_type</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">instance_type</span>
  <span class="nx">servers</span> <span class="p">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">servers</span>
<span class="p">}</span>
</code></pre></div></div><p>It’s good practice to start building everything as a module, create a library of modules to share with your team and from the very beginning to start thinking of your entire infrastructure as a <code class="language-plaintext highlighter-rouge">collection of reusable modules</code>.</p><p>After adding or removing a module, you must re-run terraform init to install the module.</p><h3 id="troubleshooting-and-logging"> <a href="#troubleshooting-and-logging" class="anchor-heading" aria-labelledby="troubleshooting-and-logging"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Troubleshooting and Logging</h3><p>The <code class="language-plaintext highlighter-rouge">TF_LOG</code> enables logging and can be set to one of the following log levels: <strong>TRACE, DEBUG, INFO, WARN or ERROR</strong>.</p><p>Once you have configured your logging you can save the output to a file. This is useful for further inspection.</p><p>The <code class="language-plaintext highlighter-rouge">TF_LOG_PATH</code> variable will create the specified file and append the logs generated by Terraform.</p><p>Example:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">export</span><span class="w"> </span><span class="nx">TF_LOG_PATH</span><span class="o">=</span><span class="n">terraform.log</span><span class="w">
</span><span class="nx">terraform</span><span class="w"> </span><span class="nx">apply</span><span class="w">
</span></code></pre></div></div><p class="fs-6 fw-300">You can generate logs from the core application and the Terraform provider separately. To enable core logging, set the <strong>TF_LOG_CORE</strong> environment variable, and to generate provider logs set the <code class="language-plaintext highlighter-rouge">TF_LOG_PROVIDER</code> to the appropriate log level.</p><hr><h2 class="text-delta">Table of contents</h2><ul><li> <a href="/my-tech/docs/Terraform/doc-1/">Terraform Deployment of basic infrastructure on AWS</a></ul></main><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><span>[ <a href="https://github.com/kyoon55">Github</a> ]</span> <span>[ <a href="mailto:kyoon5@gwu.edu">Click here to email me</a> ]</span><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/my-tech/assets/css/just-the-docs-default.css"> <script src="/my-tech/assets/js/vendor/lunr.min.js"></script> <script src="/my-tech/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/my-tech/assets/images/favicon.ico" type="image/x-icon"><title>Terraform | My SRE Stuff</title><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Terraform" /><meta property="og:locale" content="en_US" /><meta name="description" content="This page is full of articles for my SRE knowledge" /><meta property="og:description" content="This page is full of articles for my SRE knowledge" /><link rel="canonical" href="http://localhost:4000/my-tech/docs/Terraform" /><meta property="og:url" content="http://localhost:4000/my-tech/docs/Terraform" /><meta property="og:site_name" content="My SRE Stuff" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-25T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Terraform" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-25T00:00:00-05:00","datePublished":"2023-02-25T00:00:00-05:00","description":"This page is full of articles for my SRE knowledge","headline":"Terraform","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/my-tech/docs/Terraform"},"url":"http://localhost:4000/my-tech/docs/Terraform"}</script>
